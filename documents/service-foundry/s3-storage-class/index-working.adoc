= AWS S3 Storage Class for Service Foundry

:imagesdir: images

== Overview

=== Use Case Scenario

. Upload NYC Open Data to S3 Bucket with prefix 'nyc-open-data/'
. Enable S3 CSI Driver and Create S3 Storage Class
. Create Persistent Volume with S3 Storage Class using S3 Bucket and Prefix
. Create Persistent Volume Claim to use the Persistent Volume
. Deploy a Python Pod to load data from S3 using the PVC to PostgreSQL



== Install the S3 CSI Driver


[.img-wide]
image::console-storage-classes.png[]

[.img-wide]
image::console-storage-classes-s3-sc.png[]







== Grant the Node IAM Role S3 Access

NOTE: see create-s3-sc.sh

1. Find the IAM role attached to your EKS nodes:

[source,shell]
----
$ EKS_NODE_ROLE=$(aws eks describe-nodegroup --cluster-name $EKS_CLUSTER_NAME --nodegroup-name nsa2-sf-ng-0 --region $AWS_REGION --query 'nodegroup.nodeRole' --output text | cut -d '/' -f2)
$ echo $EKS_NODE_ROLE
----

== Resources

- https://github.com/awslabs/mountpoint-s3-csi-driver/blob/main/docs/INSTALL.md
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Getting Started</title>
    <link rel="stylesheet" href="/service-foundry/pages/assets/css/main.css">
<!--    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">-->
    <!-- rouge source highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">

    <!-- Highlight.js script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
        // document.querySelectorAll('pre code:not(.nohighlight)').forEach((el) => {
        //     hljs.highlightElement(el);
        // });
    </script>
</head>
<body class="bg-white text-gray-800 font-sans no-toc">

<!-- Navigation -->
<header>
    <a href="/service-foundry/pages/index.html" class="text-2xl font-semibold hover:text-teal-400">Service Foundry</a>
    <nav>
    
        
        <a href="/service-foundry/pages/getting-started/" class="active">Getting Started</a>
    
        
        <a href="/service-foundry/pages/documents/" class="">Docs</a>
    
        
        <a href="/service-foundry/pages/github/" class="">GitHub</a>
    
        
        <a href="/service-foundry/pages/developers/" class="">Developers</a>
    
</nav>

</header>

<!-- Hero Section -->
<!--<section class="bg-gray-100 py-20">-->
<!--    <div class="max-w-4xl mx-auto text-center px-6">-->
<!--        <h1 class="text-5xl font-bold mb-6 text-gray-900">Getting Started</h1>-->
<!--    </div>-->
<!--</section>-->

<div class="container">
    <main id="main-content">
        <h1 class="text-3xl font-bold mb-6 text-gray-900">Getting Started</h1>
        <div class="asciidoc">
            <div id="toc" class="toc">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#definition">Definition</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li><a href="#working-with-service-foundry-on-your-local-machine">Working with Service Foundry on your local machine</a>
<ul class="sectlevel2">
<li><a href="#install-node-js-and-npm">Install Node.js and npm</a></li>
<li><a href="#install-yeoman">Install Yeoman</a></li>
</ul>
</li>
<li><a href="#getting-generator-nsa2-from-github">Getting generator-nsa2 from GitHub</a></li>
<li><a href="#working-with-infra-foundry-module">Working with infra-foundry module</a>
<ul class="sectlevel2">
<li><a href="#service-foundry-init-step">Service Foundry init step</a></li>
<li><a href="#service-foundry-generateor-gen-step">Service Foundry generate(or gen) step</a></li>
<li><a href="#service-foundry-build-step">Service Foundry build step</a></li>
<li><a href="#service-foundry-deploy-step">Service Foundry deploy step</a></li>
</ul>
</li>
<li><a href="#working-with-o11y-foundry-module">Working with o11y-foundry module</a>
<ul class="sectlevel2">
<li><a href="#service-foundry-init-step-2">Service Foundry init step</a></li>
<li><a href="#service-foundry-generateor-gen-step-2">Service Foundry generate(or gen) step</a></li>
<li><a href="#service-foundry-build-step-2">Service Foundry build step</a></li>
<li><a href="#service-foundry-deploy-step-2">Service Foundry deploy step</a></li>
</ul>
</li>
<li><a href="#working-with-sso-foundry-modules">Working with sso-foundry modules</a>
<ul class="sectlevel2">
<li><a href="#service-foundry-init-step-3">Service Foundry init step</a></li>
<li><a href="#service-foundry-generateor-gen-step-3">Service Foundry generate(or gen) step</a></li>
<li><a href="#service-foundry-build-step-3">Service Foundry build step</a></li>
<li><a href="#service-foundry-deploy-step-3">Service Foundry deploy step</a></li>
<li><a href="#dns-setting">DNS setting</a></li>
</ul>
</li>
<li><a href="#service-foundry-submodules">Service Foundry Submodules</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Service Foundry provides automated tools to create and manage Kubernetes resources required for Turnkey applications using Kustomize, Helm, and Terraform in the way of Turnkey solution.</p>
</div>
<div class="paragraph">
<p>A single configuration file is used to generate the Kubernetes resources required for the Turnkey solution. The configuration file is a YAML file that contains the information about the application, such as the name of the application, the version of the application, and the configuration of the application.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="../assets/images/sf-concept.png" alt="sf concept">
</div>
<div class="title">Figure 1. Single configuration for Turnkey solutions - eg, Observability</div>
</div>
<div class="paragraph">
<p>Service Foundry provides a set of tools to automate this process with one single configuration file.</p>
</div>
<div class="sect2">
<h3 id="definition">Definition</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Turnkey solution</dt>
<dd>
<p>Turnkey solution is a pre-packaged software solution that is ready to use out of the box. It is a complete solution that includes all the necessary components, such as software, hardware, and documentation, to get the system up and running quickly and easily.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites">Prerequisites</h3>
<div class="paragraph">
<p>As Service Foundry is a set of tools to create and manage Kubernetes resources, you need to have the following tools installed on your local machine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubernetes cluster (EKS or AKS)</p>
</li>
<li>
<p>kubectl</p>
</li>
<li>
<p>Helm</p>
</li>
<li>
<p>Docker(optional)</p>
</li>
<li>
<p>Terraform(optional)</p>
</li>
<li>
<p>jq</p>
</li>
<li>
<p>yq</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working-with-service-foundry-on-your-local-machine">Working with Service Foundry on your local machine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the main components is the generator-nsa2, which is a Yeoman generator that generates the configuration file and all supporting files required for installing applications on Kubernetes. Node.js and npm are required to install the Yeoman generator.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the latest Node.js LTS version</p>
</li>
<li>
<p>Install Yeoman</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="install-node-js-and-npm">Install Node.js and npm</h3>
<div class="paragraph">
<p>To install Node.js and npm, you can use Homebrew on macOS. If you don&#8217;t have Homebrew installed, you can install it by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="listing">$ brew install node
$ node -v
$ npm -v</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-yeoman">Install Yeoman</h3>
<div class="paragraph">
<p>Install Yeoman globally using npm. Yeoman is a scaffolding tool for modern web applications. It provides a generator ecosystem that allows you to create and manage projects easily.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>npm <span class="nb">install</span> <span class="nt">-g</span> yo</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-generator-nsa2-from-github">Getting generator-nsa2 from GitHub</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of writing this documentation, the generator-nsa2 is a private repository. Contact <a href="https://nsalexamy.github.io/service-foundry/pages/developers/young-kim/">the author</a> to get access to the repository.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>$ git clone git@github.com:nsalexamy/generator-nsa2.git
$ cd generator-nsa2

$ npm install
$ npm link</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working-with-infra-foundry-module">Working with infra-foundry module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infrastructure Foundry is a set of tools to create and manage the infrastructure for your application. It includes tools to create and manage Kubernetes clusters, Helm charts, and Docker images.</p>
</div>
<div class="paragraph">
<p>Create a working directory and go to it. Then run the following command to create a new project for Infrastructure Foundry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">mkdir </span>nsa2-foundry <span class="o">&amp;&amp;</span> <span class="nb">cd </span>nsa2-foundry</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="service-foundry-init-step">Service Foundry init step</h3>
<div class="paragraph">
<p>Run the command to generate 'infra-foundry-config.yaml' file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>yo nsa2:infra-foundry init</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can edit this file to customize the configuration for your application.</p>
</div>
</div>
<div class="sect2">
<h3 id="service-foundry-generateor-gen-step">Service Foundry generate(or gen) step</h3>
<div class="paragraph">
<p>Run the command below to generate required files including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubernetes resource files and kustomization.yaml</p>
</li>
<li>
<p>Custom values file for Helm charts</p>
</li>
<li>
<p>Terraform files</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ yo nsa2:infra-foundry generate</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-foundry-build-step">Service Foundry build step</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The infra-foundry module does not need to push custom Docker images to the Container Registry. So, you can skip the 'build' step.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="service-foundry-deploy-step">Service Foundry deploy step</h3>
<div class="paragraph">
<p>Run the command below to deploy the generated files to your Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>yo nsa2:infra-foundry deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, it will install the following tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cert-manager</p>
</li>
<li>
<p>Keycloak</p>
</li>
<li>
<p>Traefik</p>
</li>
<li>
<p>Prometheus Operator</p>
</li>
<li>
<p>OpenTelemetry Operator</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working-with-o11y-foundry-module">Working with o11y-foundry module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The o11y-foundry module is a set of tools to create and manage the observability for your application. It includes tools to create and manage Prometheus, Grafana, and OpenTelemetry.</p>
</div>
<div class="paragraph">
<p>Create a working directory and go to it. Then run the following command to create a new project for Observability Foundry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">mkdir </span>o11y <span class="o">&amp;&amp;</span> <span class="nb">cd </span>o11y</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="service-foundry-init-step-2">Service Foundry init step</h3>
<div class="paragraph">
<p>Run the command to generate 'o11y-foundry-config.yaml' file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>yo nsa2:o11y-foundry init</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command will ask you to enter the following information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">? Kubernetes namespace? o11y
? Cloud Provider (Azure, AWS, GCP) (Use arrow keys)
? Container Registry (ACR or ECR. e.g. my-cr.azurecr.io)
? Root domain (e.g. example.com)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the description of each argument:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The namespace where the observability tools will be installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cloud provider where the Kubernetes cluster is running. (AWS, Azure, GCP). When pushing Docker images to the Container Registry, the generator will use the CLI commnand of the cloud provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Container Registry where the Docker images will be pushed. (e.g. my-cr.azurecr.io)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The root domain for the observability tools. (e.g. example.com)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="service-foundry-generateor-gen-step-2">Service Foundry generate(or gen) step</h3>
<div class="paragraph">
<p>Run the command below to generate required files including:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>yo nsa2:o11y-foundry generate</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command will generate the following Kubernetes files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ tree k8s

k8s
├── common
│   ├── kustomization.yaml
│   └── observability-configmap.yaml
├── grafana
│   ├── grafana-admin-credentials.yaml
│   ├── grafana-client-secret.yaml
│   └── kustomization.yaml
├── jaeger-collector
│   └── jaeger-collector.yaml
├── opentelemetry-operator
│   └── opentelemetry-operator.yaml
├── otel-collector
│   ├── kustomization.yaml
│   ├── otel-collector-rbac.yaml
│   ├── otel-collector.yaml
│   ├── otel-targetallocator-cr-role.yaml
│   └── otel-targetallocator-role.yaml
├── prometheus
│   ├── kustomization.yaml
│   ├── prometheus-rbac.yaml
│   ├── prometheus-service.yaml
│   └── prometheus.yaml
└── prometheus-operator
    └── bundle.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>The command will also generate the following Helm files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ tree helm-charts

helm-charts
├── cassandra
│   ├── cassandra-12.1.1.tgz
│   ├── cassandra-credentials.yaml
│   ├── cassandra-initdb-configmap.yaml
│   └── cassandra-values.yaml
├── cert-manager
│   ├── cert-manager-v1.17.1.tgz
│   └── custom-values.yaml
├── grafana
│   ├── grafana-8.8.5.tgz
│   └── grafana-values.yaml
├── oauth2-proxy
│   ├── custom-values.yaml
│   └── oauth2-proxy-7.12.6.tgz
└── opensearch
    ├── data-prepper-0.3.1.tgz
    ├── data-prepper-values.yaml
    ├── esnode-certs.yaml
    ├── opensearch-2.30.1.tgz
    ├── opensearch-2.32.0.tgz
    ├── opensearch-dashboards-2.26.0.tgz
    ├── opensearch-dashboards-2.28.0.tgz
    ├── opensearch-dashboards-values.yaml
    └── opensearch-values.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>This command will also generate the following shell files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ tree bin

bin
├── deploy-cassandra.sh
├── deploy-grafana.sh
├── deploy-jaeger.sh
├── deploy-nsa2-otel-exporter.sh
├── deploy-opensearch-stack.sh
├── deploy-otel-collector.sh
├── deploy-otel-spring-example.sh
├── deploy-prometheus.sh
├── undeploy-cassandra.sh
├── undeploy-grafana.sh
├── undeploy-jaeger.sh
├── undeploy-nsa2-otel-exporter.sh
├── undeploy-opensearch-stack.sh
├── undeploy-otel-collector.sh
├── undeploy-otel-spring-example.sh
└── undeploy-prometheus.sh</pre>
</div>
</div>
<div class="paragraph">
<p>With the script files, you can easily deploy and undeploy the observability tools. When using deploy step, all the tools will be installed in the Kubernetes cluster. When using undeploy step, all the tools will be uninstalled from the Kubernetes cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="service-foundry-build-step-2">Service Foundry build step</h3>
<div class="paragraph">
<p>For the o11y-foundry module, you need to build the Docker images and push them to the Container Registry. You can use the following command to build the Docker images and push them to the Container Registry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>yo nsa2:o11y-foundry build</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the Docker images, you can use the following command to list the Docker images in the Container Registry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>aws ecr describe-repositories <span class="nt">--query</span> <span class="s1">'repositories[*].repositoryName'</span>
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>Example output
<span class="go">- nsa2-otel-exporter
- o11y-otel-spring-example</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-foundry-deploy-step-2">Service Foundry deploy step</h3>
<div class="paragraph">
<p>Run the command below to deploy the generated files to your Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>yo nsa2:o11y-foundry deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the installation, you can use the following command to list the Kubernetes resources in the Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>kubectl get all <span class="nt">-n</span> o11y</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example output:</strong></p>
</div>
<details class="img-wide">
<summary class="title">Expand to see the output</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>NAME                                         READY   STATUS    RESTARTS      AGE
pod/cassandra-0                              1/1     Running   0             12m
pod/cassandra-1                              1/1     Running   0             10m
pod/cassandra-2                              1/1     Running   0             8m56s
pod/data-prepper-549b89cc4c-9dk6r            1/1     Running   0             11m
pod/grafana-f454859cb-n47n6                  1/1     Running   0             11m
pod/jaeger-collector-6666cdf7b9-b9qrs        1/1     Running   4 (10m ago)   11m
pod/opensearch-cluster-master-0              1/1     Running   0             11m
pod/opensearch-cluster-master-1              1/1     Running   0             11m
pod/opensearch-cluster-master-2              1/1     Running   0             11m
pod/opensearch-dashboards-6c9cddc4c4-wsp9r   1/1     Running   0             11m
pod/otel-collector-0                         1/1     Running   2 (11m ago)   11m
pod/otel-targetallocator-549986cb8c-bk8cp    1/1     Running   0             11m
pod/prometheus-prometheus-0                  2/2     Running   0             11m

NAME                                         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                                  AGE
service/cassandra                            ClusterIP   10.100.31.101    &lt;none&gt;        9042/TCP                                 12m
service/cassandra-headless                   ClusterIP   None             &lt;none&gt;        7000/TCP,7001/TCP,7199/TCP,9042/TCP      12m
service/data-prepper                         ClusterIP   10.100.245.211   &lt;none&gt;        2021/TCP,21890/TCP,21891/TCP,21892/TCP   11m
service/grafana                              ClusterIP   10.100.55.223    &lt;none&gt;        80/TCP                                   11m
service/jaeger-collector                     ClusterIP   10.100.15.158    &lt;none&gt;        16686/TCP,4317/TCP,4318/TCP              11m
service/jaeger-collector-extension           ClusterIP   10.100.211.28    &lt;none&gt;        16686/TCP                                11m
service/jaeger-collector-headless            ClusterIP   None             &lt;none&gt;        16686/TCP,4317/TCP,4318/TCP              11m
service/jaeger-collector-monitoring          ClusterIP   10.100.116.125   &lt;none&gt;        8888/TCP                                 11m
service/opensearch-cluster-master            ClusterIP   10.100.55.192    &lt;none&gt;        9200/TCP,9300/TCP,9600/TCP               11m
service/opensearch-cluster-master-headless   ClusterIP   None             &lt;none&gt;        9200/TCP,9300/TCP,9600/TCP               11m
service/opensearch-dashboards                ClusterIP   10.100.217.97    &lt;none&gt;        5601/TCP,9601/TCP                        11m
service/otel-collector                       ClusterIP   10.100.74.170    &lt;none&gt;        4317/TCP,4318/TCP                        11m
service/otel-collector-headless              ClusterIP   None             &lt;none&gt;        4317/TCP,4318/TCP                        11m
service/otel-collector-monitoring            ClusterIP   10.100.13.37     &lt;none&gt;        8888/TCP                                 11m
service/otel-targetallocator                 ClusterIP   10.100.211.248   &lt;none&gt;        80/TCP                                   11m
service/prometheus                           NodePort    10.100.114.238   &lt;none&gt;        9090:32709/TCP                           11m
service/prometheus-operated                  ClusterIP   None             &lt;none&gt;        9090/TCP                                 11m

NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/data-prepper            1/1     1            1           11m
deployment.apps/grafana                 1/1     1            1           11m
deployment.apps/jaeger-collector        1/1     1            1           11m
deployment.apps/opensearch-dashboards   1/1     1            1           11m
deployment.apps/otel-targetallocator    1/1     1            1           11m

NAME                                               DESIRED   CURRENT   READY   AGE
replicaset.apps/data-prepper-549b89cc4c            1         1         1       11m
replicaset.apps/grafana-f454859cb                  1         1         1       11m
replicaset.apps/jaeger-collector-6666cdf7b9        1         1         1       11m
replicaset.apps/opensearch-dashboards-6c9cddc4c4   1         1         1       11m
replicaset.apps/otel-targetallocator-549986cb8c    1         1         1       11m

NAME                                         READY   AGE
statefulset.apps/cassandra                   3/3     12m
statefulset.apps/opensearch-cluster-master   3/3     11m
statefulset.apps/otel-collector              1/1     11m
statefulset.apps/prometheus-prometheus       1/1     11m</pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working-with-sso-foundry-modules">Working with sso-foundry modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The sso-foundry module is a set of tools to create and manage the Single Sign-On (SSO) for your application. It includes tools to create and manage Keycloak, OAuth2 Proxy, and OpenID Connect.</p>
</div>
<div class="paragraph">
<p>The sso-foundry works with Kubernetes services and Ingress resources to add authentication and authorization to your application.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a working directory and go to it. Then run the following command to create a new project for SSO Foundry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">mkdir </span>sso <span class="o">&amp;&amp;</span> <span class="nb">cd </span>sso</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="service-foundry-init-step-3">Service Foundry init step</h3>
<div class="paragraph">
<p>Run the command to generate 'sso-foundry-config.yaml' file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>yo nsa2:sso-foundry init
<span class="go">
? Namespace o11y
? Root Domain(eg. example.com) nsa2.com</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The command will ask you to enter the following information:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Argument</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The namespace where the SSO tools will be installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root Domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The root domain for the SSO tools. (e.g. example.com)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="service-foundry-generateor-gen-step-3">Service Foundry generate(or gen) step</h3>
<div class="paragraph">
<p>Run the command below to generate required files including:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>yo nsa2:sso-foundry generate</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command will generate the following Kubernetes files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ tree k8s

k8s
├── keycloak
│   ├── keycloak-credentials-secret.yaml
│   ├── keycloak-namespace.yaml
│   ├── keycloak-postgresql-credentials-secret.yaml
│   ├── kustomization.yaml
│   └── nsa2-realm-export.json
├── oauth2-proxy
│   ├── kustomization.yaml
│   ├── oauth2-proxy-config.yaml
│   └── oauth2-proxy-secret.yaml
└── traefik
    ├── forward-auth-middleware.yaml
    ├── kustomization.yaml
    ├── o11y-sso-ingress.yaml
    └── oauth2-proxy-ingress.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>The command will also generate the following Helm files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ tree helm-charts

helm-charts
├── keycloak
│   ├── custom-values.yaml
│   └── keycloak-24.4.13.tgz
└── oauth2-proxy
    ├── custom-values.yaml
    └── oauth2-proxy-7.12.6.tgz</pre>
</div>
</div>
<div class="paragraph">
<p>The command will also generate the following Terraform files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ tree terraform

terraform
└── keycloak
    ├── main.tf
    ├── terraform.tfstate
    ├── terraform.tfstate.backup
    ├── terraform.tfvars
    └── variables.tf</pre>
</div>
</div>
<div class="paragraph">
<p>The command will also generate the following shell files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ tree bin

bin
├── deploy-keycloak.sh
└── undeploy-keycloak.sh</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-foundry-build-step-3">Service Foundry build step</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The sso-foundry module does not need to push custom Docker images to the Container Registry. So, you can skip the 'build' step.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="service-foundry-deploy-step-3">Service Foundry deploy step</h3>
<div class="paragraph">
<p>Run the command below to deploy the generated files to your Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>yo nsa2:sso-foundry deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify the installation by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>kubectl <span class="nt">-n</span> o11y get ingress</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example output:</strong></p>
</div>
<details class="img-wide">
<summary class="title">Expand to see the output</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">NAME                   CLASS     HOSTS                                                              ADDRESS                                                                  PORTS   AGE
o11y-sso-ingress       traefik   jaeger.nsa2.com,prometheus.nsa2.com,grafana.nsa2.com + 1 more...   ae4306323ae09437d9c125327de37cd0-715418189.ca-west-1.elb.amazonaws.com   80      3m32s
oauth2-proxy-ingress   traefik   oauth2-proxy.nsa2.com                                              ae4306323ae09437d9c125327de37cd0-715418189.ca-west-1.elb.amazonaws.com   80      3m31s</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="dns-setting">DNS setting</h3>
<div class="listingblock">
<div class="title">sso-foundry-config.yaml - oauth2-proxy settings</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">oauth2-proxy</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">o11y</span>
  <span class="na">release-name</span><span class="pi">:</span> <span class="s">oauth2-proxy</span>  <span class="c1"># release name for helm</span>
  <span class="na">ingresses</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">o11y-sso-ingress</span>
      <span class="na">namespace</span><span class="pi">:</span> <span class="s">o11y</span>
      <span class="na">services</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">service-name</span><span class="pi">:</span> <span class="s">jaeger-collector</span>
          <span class="na">port-name</span><span class="pi">:</span> <span class="s">jaeger</span>
          <span class="na">subdomain</span><span class="pi">:</span> <span class="s">jaeger</span>
        <span class="pi">-</span> <span class="na">service-name</span><span class="pi">:</span> <span class="s">prometheus</span>
          <span class="na">port-name</span><span class="pi">:</span> <span class="s">web</span>
          <span class="na">subdomain</span><span class="pi">:</span> <span class="s">prometheus</span>
        <span class="pi">-</span> <span class="na">service-name</span><span class="pi">:</span> <span class="s">grafana</span>
          <span class="na">port-name</span><span class="pi">:</span> <span class="s">service</span>
          <span class="na">subdomain</span><span class="pi">:</span> <span class="s">grafana</span>
        <span class="pi">-</span> <span class="na">service-name</span><span class="pi">:</span> <span class="s">opensearch-dashboards</span>
          <span class="na">port-name</span><span class="pi">:</span> <span class="s">http</span>
          <span class="na">subdomain</span><span class="pi">:</span> <span class="s">os-dashboards</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The base domain that we input in the init step is used to create the DNS records for the SSO tools. <a href="http://{subdomain}.{base_domain}" class="bare">http://{subdomain}.{base_domain}</a> is used to access the SSO tools. For example, <a href="http://jaeger.nsa2.com" class="bare">http://jaeger.nsa2.com</a> is used to access the Jaeger UI.</p>
</div>
<div class="paragraph">
<p>Here is an example of the DNS records that are created for the SSO tools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">{traefik-service-lb-ip-address}   jaeger.nsa2.com
{traefik-service-lb-ip-address}	  prometheus.nsa2.com
{traefik-service-lb-ip-address}	  oauth2-proxy.nsa2.com
{traefik-service-lb-ip-address}	  grafana.nsa2.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s navigate to the Jaeger UI using the following URL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://jaeger.nsa2.com" class="bare">http://jaeger.nsa2.com</a></p>
</li>
<li>
<p><a href="http://promethues.nsa2.com" class="bare">http://promethues.nsa2.com</a></p>
</li>
<li>
<p><a href="http://grafana.nsa2.com" class="bare">http://grafana.nsa2.com</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To access those URLs, username and password are required. The credentials are created in the Keycloak server, which is devops user and password.</p>
</div>
<div class="paragraph">
<p>So far, we have learned how Service Foundry works with the infra-foundry, o11y-foundry, and sso-foundry modules.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="service-foundry-submodules">Service Foundry Submodules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apart from infra-foundry, Service Foundry has several submodules that can be used to create and manage Kubernetes resources for a certain application. The submodules are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>infra-foundry</p>
</li>
<li>
<p>o11y-foundry</p>
</li>
<li>
<p>sso-foundry</p>
</li>
<li>
<p>backend-foundry</p>
</li>
<li>
<p>bigdata-foundry</p>
</li>
<li>
<p>and more&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about each submodule, please refer to the documentation of each submodule.</p>
</div>
<div class="paragraph">
<p><a href="submodules/">Service Foundry Submodules</a></p>
</div>
</div>
</div>
        </div>
    </main>
</div>

<!-- Footer -->
<!-- Footer -->
<footer class="bg-gray-900 text-white text-sm py-6 text-center">
    © 2025 Service Foundry. All rights reserved.
</footer>


</body>
</html>
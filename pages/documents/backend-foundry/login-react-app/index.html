<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spring Cloud Gateway and Authorization Server with React Web App</title>
    <!-- rouge source highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/service-foundry/pages/assets/css/main.css">

    <!-- Highlight.js script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</head>
<body class="">

<!-- Header -->
<header>
<!--    <div class="logo text-xl font-semibold">Service Foundry</div>-->
    <a href="/service-foundry/pages/index.html" class="text-2xl font-semibold hover:text-teal-400">
    Service Foundry
</a>
    <nav>
    
        
        <a href="/service-foundry/pages/getting-started/" class="">Getting Started</a>
    
        
        <a href="/service-foundry/pages/products/" class="">Products</a>
    
        
        <a href="/service-foundry/pages/documents/" class="active">Docs</a>
    
        
        <a href="/service-foundry/pages/github/" class="">GitHub</a>
    
        
        <a href="/service-foundry/pages/developers/" class="">Developers</a>
    
        
        <a href="/service-foundry/pages/demo/" class="">Demo</a>
    
</nav>
</header>


    <!-- Sub-navigation for Foundries -->
    <div class="subnav">

    
    <a href="/service-foundry/pages/documents/blog/" class="">Blog</a>

    
    <a href="/service-foundry/pages/documents/infra-foundry/" class="">Infra</a>

    
    <a href="/service-foundry/pages/documents/sso-foundry/" class="">SSO</a>

    
    <a href="/service-foundry/pages/documents/o11y-foundry/" class="">Observability</a>

    
    <a href="/service-foundry/pages/documents/backend-foundry/" class="active">Backend</a>

    
    <a href="/service-foundry/pages/documents/bigdata-foundry/" class="">Big Data</a>

<!--    <a href="/service-foundry/pages/documents/infra-foundry/index-backup.html" class="text-gray-300 hover:text-white">Infra</a>-->
<!--    <a href="/service-foundry/pages/documents/sso-foundry/index-backup.html" class="text-gray-300 hover:text-white">SSO</a>-->
<!--    <a href="/service-foundry/pages/documents/o11y-foundry/index-backup.html" class="text-gray-300 hover:text-white">Observability</a>-->
<!--    <a href="/service-foundry/pages/documents/backend-foundry/index-backup.html" class="text-gray-300 hover:text-white">Backend</a>-->
<!--    <a href="/service-foundry/pages/documents/bigdata-foundry/index-backup.html" class="text-gray-300 hover:text-white">Big Data</a>-->
</div>





<!-- Breadcrumb -->

    <nav class="breadcrumb-wrapper">
    <ol class="breadcrumb">
        
        <li>
            
            <a href="/service-foundry/pages/">Home</a>
            
            
            <span class="separator">/</span>
            
        </li>
        
        <li>
            
            <a href="/service-foundry/pages/documents/">Docs</a>
            
            
            <span class="separator">/</span>
            
        </li>
        
        <li>
            
            <a href="/service-foundry/pages/documents/backend-foundry/">Backend Foundry</a>
            
            
        </li>
        
    </ol>
</nav>





<!-- Main Layout -->
<div class="container">


    <nav id="toc-container" class="toc-nav"></nav>


    <main id="main-content">
        
        <div class="author-box">
            Young Gyu Kim
            &lt;<a href="mailto:credemol@gmail.com" style="color: #0d9488; text-decoration: none;">credemol@gmail.com</a>&gt;
        </div>
        

        <!-- Title -->
        
        <h1 class="page-title">
            Spring Cloud Gateway and Authorization Server with React Web App
        </h1>
        

        <div class="asciidoc">
            <div id="toc" class="toc">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#backend-for-frontend-bff-pattern">Backend for Frontend (BFF) Pattern</a></li>
<li><a href="#create-a-new-react-app">Create a new React app</a>
<ul class="sectlevel2">
<li><a href="#run-the-application">Run the application</a></li>
</ul>
</li>
<li><a href="#pages">Pages</a>
<ul class="sectlevel2">
<li><a href="#app-tsx">App.tsx</a></li>
<li><a href="#react-hooks">React Hooks</a></li>
<li><a href="#login-page">Login Page</a></li>
<li><a href="#postloginpage">PostLoginPage</a></li>
<li><a href="#homepage">HomePage</a></li>
<li><a href="#profilepage">ProfilePage</a></li>
<li><a href="#postlogoutpage">PostLogoutPage</a></li>
<li><a href="#screenshots">Screenshots</a></li>
<li><a href="#logout">Logout</a></li>
</ul>
</li>
<li><a href="#csrf-protection">CSRF Protection</a>
<ul class="sectlevel2">
<li><a href="#csrfcontroller">CsrfController</a></li>
<li><a href="#security-configuration-on-spring-cloud-gateway">Security Configuration on Spring Cloud Gateway</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#references">References</a>
<ul class="sectlevel2">
<li><a href="#youtube">Youtube</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="imageblock img-wide">
<div class="content">
<img src="images/spa-with-bff.png" alt="spa with bff">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This article is part of a series on Spring Cloud Gateway. The other articles in the series are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Part 1: <a href="https://www.linkedin.com/pulse/spring-cloud-gateway-using-virtual-threads-young-gyu-kim-zpoxc/">Spring Cloud Gateway with Virtual Threads</a></p>
</li>
<li>
<p>Part 2: <a href="https://www.linkedin.com/pulse/spring-cloud-gateway-oauth-20-authorization-server-young-gyu-kim-sa4kc/">Spring Cloud Gateway with Spring Authorization Server</a></p>
</li>
<li>
<p>Part 3: <a href="https://www.linkedin.com/pulse/spring-cloud-gateway-authorization-server-using-database-kim-brbbc/">Spring Cloud Gateway with Spring Authorization Server using Database</a></p>
</li>
<li>
<p>Part 4: <a href="https://www.linkedin.com/pulse/spring-cloud-gateway-authorization-server-roles-young-gyu-kim-1m0ac/">Spring Cloud Gateway &amp; Spring Authorization Server with Roles</a></p>
</li>
<li>
<p>Part 5: <a href="https://www.linkedin.com/pulse/spring-cloud-gateway-configwatcher-young-gyu-kim-x4qqc/">Spring Cloud Gateway with ConfigWatcher</a></p>
</li>
<li>
<p>Part 6: <a href="https://www.linkedin.com/pulse/spring-authorization-server-userinfo-endpoint-young-gyu-kim-0duqc/">Spring Authorization Server with Userinfo Endpoint</a></p>
</li>
<li>
<p>Part 7: <a href="https://www.linkedin.com/pulse/spring-cloud-gateway-authorization-server-react-web-app-young-gyu-kim-zevoc/">Spring Cloud Gateway and Authorization Server with React Web App</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This article covers how to secure a React web application with Spring Security and Spring Cloud Gateway.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backend-for-frontend-bff-pattern">Backend for Frontend (BFF) Pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To understand how this application works, we need to understand the Backend for Frontend (BFF) pattern. In this pattern, access_token, id_token and refresh_token are not stored in the browser for security reasons. Instead, the tokens are stored in the backend server. And the frontend application and the backend server share session id in the cookie. And the backend server uses the session id to retrieve the tokens from the session store.</p>
</div>
<div class="paragraph">
<p>It is crucial to understand that we need to use the same domain for the frontend application and the backend server. Otherwise, the browser will not send the cookie to the backend server. For example, if the frontend application is running on <code><a href="http://localhost:3000" class="bare">http://localhost:3000</a></code> and the backend server is running on <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>, the browser will not send the cookie to the backend server. In this article, we are going to use <code>nsa2-gateway</code> domain for both the frontend application and the backend server to use the previous working example of this series.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://nsa2-gateway:3000" class="bare">http://nsa2-gateway:3000</a> - Frontend Application (React)</p>
</li>
<li>
<p><a href="http://nsa2-gateway:8080" class="bare">http://nsa2-gateway:8080</a> - Backend Server (Spring Cloud Gateway, Oauth2 Client)</p>
</li>
<li>
<p><a href="http://nsa2-auth-server:9000" class="bare">http://nsa2-auth-server:9000</a> - Spring Authorization Server</p>
</li>
<li>
<p><a href="http://nsa2-resource-server:8082" class="bare">http://nsa2-resource-server:8082</a> - OAuth2 Resource Server example</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Setting up the same domain for the frontend application and the backend server can be nicely done when using reverse proxy like Nginx or Ingress Controller in Kubernetes. We are going to cover this in the next article.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Spring Authorization Server will not issue refresh tokens for a public client. We recommend the backend for frontend (BFF) pattern as an alternative to exposing a public client. See gh-297 for more information.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; https://docs.spring.io/spring-authorization-server/reference/guides/how-to-pkce.html
</div>
</div>
<div class="paragraph">
<p>For more information, see the following links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-authorization-server/reference/overview.html" class="bare">https://docs.spring.io/spring-authorization-server/reference/overview.html</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-authorization-server/reference/guides/how-to-pkce.html" class="bare">https://docs.spring.io/spring-authorization-server/reference/guides/how-to-pkce.html</a></p>
</li>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/draft-bertocci-oauth2-tmi-bff-01" class="bare">https://datatracker.ietf.org/doc/html/draft-bertocci-oauth2-tmi-bff-01</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-a-new-react-app">Create a new React app</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We are going to use <code>vite</code> to create a new React app. To create a new React app, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>npm create vite@latest nsa2-login-app <span class="nt">--</span> <span class="nt">--template</span> react-ts

<span class="c"># or</span>
<span class="nv">$ </span>npm init vite@latest nsa2-login-app <span class="nt">--</span> <span class="nt">--template</span> react-ts


<span class="nv">$ </span><span class="nb">cd </span>nsa2-login-app
<span class="nv">$ </span>npm <span class="nb">install</span>

<span class="nv">$ </span>npm <span class="nb">install </span>react-router-dom

<span class="nv">$ </span>npm <span class="nb">install </span>react-cookie

<span class="c">#$ npm install @material-tailwind/react # typescript is not supported</span>
<span class="nv">$ </span>npm i @heroicons/react

<span class="nv">$ </span>npm <span class="nb">install </span>tailwindcss
<span class="nv">$ </span>npm <span class="nb">install</span> @tailwindcss/forms

<span class="nv">$ </span>npx tailwindcss init

Created Tailwind CSS config file: tailwind.config.js

<span class="c">#$ npm install -D daisyui@latest</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">tailwind.config.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="cm">/** @type {import('tailwindcss').Config} */</span>

<span class="kd">const</span> <span class="nx">defaultTheme</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">tailwindcss/defaultTheme</span><span class="dl">'</span><span class="p">)</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">content</span><span class="p">:</span> <span class="p">[</span>
      <span class="dl">"</span><span class="s2">./index-backup.html</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">./src/**/*.{js,ts,jsx,tsx}</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="na">theme</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">extend</span><span class="p">:</span> <span class="p">{},</span>
  <span class="p">},</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
      <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">daisyui</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">],</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To change port number, update the following line in the package.json.</p>
</div>
<div class="listingblock">
<div class="title">vite.config.ts</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="typescript"><span class="k">import</span> <span class="p">{</span> <span class="nx">defineConfig</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">vite</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">react</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@vitejs/plugin-react</span><span class="dl">'</span>

<span class="c1">// https://vitejs.dev/config/</span>
<span class="k">export</span> <span class="k">default</span> <span class="nf">defineConfig</span><span class="p">({</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span><span class="nf">react</span><span class="p">()],</span>
  <span class="na">server</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">port</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span>
    <span class="na">host</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="run-the-application">Run the application</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>npm run dev</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pages">Pages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this application, we are going to have the following pages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LoginPage - Redirect to Login Page that is provided by Spring Authorization Server</p>
</li>
<li>
<p>PostLoginPage - Callback Page after login, and redirect to HomePage</p>
</li>
<li>
<p>HomePage (Protected Page)</p>
</li>
<li>
<p>ProfilePage (Protected Page)</p>
</li>
<li>
<p>PostLogoutPage - Callback Page after logout, and redirect to LoginPage</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="app-tsx">App.tsx</h3>
<div class="paragraph">
<p>App.tsx is the main component that contains the routing configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="tsx"><span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">AuthProvider</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./hooks/useAuth.tsx</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">BrowserRouter</span><span class="p">,</span> <span class="nx">Route</span><span class="p">,</span> <span class="nx">Routes</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-router-dom</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">HomePage</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./pages/Home.tsx</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">LoginPage</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./pages/Login.tsx</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">PostLoginPage</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./pages/PostLogin.tsx</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ProfilePage</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./pages/Profile.tsx</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ProtectedRoute</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./components/ProtectedRoute.tsx</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">PostLogoutPage</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./pages/PostLogout.tsx</span><span class="dl">"</span><span class="p">;</span>


<span class="kd">const</span> <span class="nx">App</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return </span><span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">BrowserRouter</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">AuthProvider</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nc">Routes</span><span class="p">&gt;</span>
                    <span class="si">{</span><span class="cm">/*&lt;Route element={&lt;PrivateRoutes/&gt;}&gt;*/</span><span class="si">}</span>
                    <span class="si">{</span><span class="cm">/*    &lt;Route path="/" element={&lt;HomePage/&gt;}/&gt;*/</span><span class="si">}</span>
                    <span class="si">{</span><span class="cm">/*&lt;/Route&gt;*/</span><span class="si">}</span>
                    <span class="p">&lt;</span><span class="nc">Route</span> <span class="na">path</span><span class="p">=</span><span class="s">"/"</span> <span class="na">element</span><span class="p">=</span><span class="si">{</span><span class="p">&lt;</span><span class="nc">ProtectedRoute</span><span class="p">&gt;&lt;</span><span class="nc">HomePage</span><span class="p">/&gt;&lt;/</span><span class="nc">ProtectedRoute</span><span class="p">&gt;</span><span class="si">}</span><span class="p">/&gt;</span>
                    <span class="p">&lt;</span><span class="nc">Route</span> <span class="na">path</span><span class="p">=</span><span class="s">"/login"</span> <span class="na">element</span><span class="p">=</span><span class="si">{</span><span class="p">&lt;</span><span class="nc">LoginPage</span><span class="p">/&gt;</span><span class="si">}</span><span class="p">/&gt;</span>
                    <span class="p">&lt;</span><span class="nc">Route</span> <span class="na">path</span><span class="p">=</span><span class="s">"/post-login"</span> <span class="na">element</span><span class="p">=</span><span class="si">{</span><span class="p">&lt;</span><span class="nc">PostLoginPage</span><span class="p">/&gt;</span><span class="si">}</span><span class="p">/&gt;</span>
                    <span class="p">&lt;</span><span class="nc">Route</span> <span class="na">path</span><span class="p">=</span><span class="s">"/post-logout"</span> <span class="na">element</span><span class="p">=</span><span class="si">{</span><span class="p">&lt;</span><span class="nc">PostLogoutPage</span><span class="p">/&gt;</span><span class="si">}</span><span class="p">/&gt;</span>
                    <span class="p">&lt;</span><span class="nc">Route</span> <span class="na">path</span><span class="p">=</span><span class="s">"/profile"</span> <span class="na">element</span><span class="p">=</span><span class="si">{</span><span class="p">&lt;</span><span class="nc">ProtectedRoute</span><span class="p">&gt;&lt;</span><span class="nc">ProfilePage</span><span class="p">/&gt;&lt;/</span><span class="nc">ProtectedRoute</span><span class="p">&gt;</span><span class="si">}</span><span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nc">Routes</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nc">AuthProvider</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nc">BrowserRouter</span><span class="p">&gt;</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>'/' and '/profile' are protected routes. If the user is not authenticated, the user will be redirected to the login page.</p>
</div>
</div>
<div class="sect2">
<h3 id="react-hooks">React Hooks</h3>
<div class="paragraph">
<p>For this application, we are going to use the following React hooks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>useLocalStorage: Custom hook to store the user information in the local storage</p>
</li>
<li>
<p>useAuth: Custom hook to manage the authentication state</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">useLocalStorage.tsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="typescript"><span class="k">import</span> <span class="p">{</span><span class="nx">useState</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">UserType</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../types/User</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">useLocalStorage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">key</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">initialValue</span><span class="p">:</span> <span class="p">(</span><span class="nx">UserType</span> <span class="o">|</span> <span class="kr">string</span> <span class="o">|</span> <span class="nx">boolean</span> <span class="o">|</span> <span class="kc">null</span><span class="p">))</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">storedValue</span><span class="p">,</span> <span class="nx">setStoredValue</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">item</span> <span class="p">?</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">:</span> <span class="nx">initialValue</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">initialValue</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="kd">const</span> <span class="nx">setValue</span> <span class="o">=</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nf">setStoredValue</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="p">[</span><span class="nx">storedValue</span><span class="p">,</span> <span class="nx">setValue</span><span class="p">];</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This hook is used to store the user information in the local storage.</p>
</div>
<div class="listingblock">
<div class="title">useAuth.tsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="typescript"><span class="k">import</span> <span class="p">{</span><span class="nx">createContext</span><span class="p">,</span> <span class="nx">ReactNode</span><span class="p">,</span> <span class="nx">useContext</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">useLocalStorage</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./useLocalStorage.tsx</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">Props</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">children</span><span class="p">:</span> <span class="nx">ReactNode</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">AuthContextType</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">authenticated</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
    <span class="nl">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="na">setAuthenticated</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
    <span class="nl">setUsername</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">initialAuthContext</span><span class="p">:</span> <span class="nx">AuthContextType</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">authenticated</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">setAuthenticated</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>
    <span class="na">username</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
    <span class="na">setUsername</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">AuthContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">AuthContextType</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">initialAuthContext</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">AuthProvider</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="nx">Props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="kd">const</span> <span class="p">[</span><span class="nx">authenticated</span><span class="p">,</span> <span class="nx">setAuthenticated</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useLocalStorage</span><span class="p">(</span><span class="dl">'</span><span class="s1">authenticated</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">setUsername</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useLocalStorage</span><span class="p">(</span><span class="dl">'</span><span class="s1">username</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>

    <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">authenticated</span><span class="p">,</span>
        <span class="nx">setAuthenticated</span><span class="p">,</span>
        <span class="nx">username</span><span class="p">,</span>
        <span class="nx">setUsername</span>
    <span class="p">};</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">AuthContext</span><span class="p">.</span><span class="nx">Provider</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">value</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">children</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/AuthContext.Provider</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">useAuth</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">useContext</span><span class="p">(</span><span class="nx">AuthContext</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span> <span class="p">{</span> <span class="nx">AuthContext</span><span class="p">,</span> <span class="nx">AuthProvider</span><span class="p">,</span> <span class="nx">useAuth</span> <span class="p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This hook is used to manage the authentication state. For protected routes, we need to check if the user is authenticated. If the user is not authenticated, the user will be redirected to the login page.</p>
</div>
</div>
<div class="sect2">
<h3 id="login-page">Login Page</h3>
<div class="paragraph">
<p>LoginPage.tsx simply redirects to the login page that is provided by Spring Authorization Server. The login flow looks like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>User tries to access the protected page</p>
</li>
<li>
<p>User is redirected to the login page</p>
</li>
<li>
<p>login page redirects to <a href="http://nsa2-gateway:8080/user/login" class="bare">http://nsa2-gateway:8080/user/login</a> which is protected by Spring Authorization Server</p>
</li>
<li>
<p>It redirects to the login page of Spring Authorization Server</p>
</li>
<li>
<p>User logs in</p>
</li>
<li>
<p><a href="http://nsa2-gateway:8080/user/login" class="bare">http://nsa2-gateway:8080/user/login</a> is called after login</p>
</li>
<li>
<p>It redirects to the PostLoginPage</p>
</li>
<li>
<p>PostLoginPage saves username and authenticated flag in the local storage</p>
</li>
<li>
<p>PostLoginPage redirects to the HomePage</p>
<div class="dlist">
<dl>
<dt class="hdlist1">NOTE</dt>
<dd>
<p>We need to be aware of the Session ID cookie. It is required to set 'credentials' to 'include' when making a request to the backend server.</p>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">pages/LoginPage.tsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="typescript"><span class="k">import</span> <span class="p">{</span><span class="nx">useEffect</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">LoginPage</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NSA2_GATEWAY_URL</span><span class="p">}</span><span class="s2">/user/login`</span>

    <span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">onLoad</span><span class="dl">'</span><span class="p">)</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url</span>
    <span class="p">},</span> <span class="p">[</span><span class="nx">url</span><span class="p">]);</span>

    <span class="k">return </span><span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Redirecting</span> <span class="nx">to</span> <span class="nx">OAuth2</span> <span class="nx">Server</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>

<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">LoginPage</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This page does not need to have any UI. It simply redirects to the login page that is running on the Spring Cloud Gateway application. Since it is a protected page, the user will be redirected to the login page of the Spring Authorization Server.</p>
</div>
<div class="paragraph">
<p>After login is successful, /user/login is called, and it redirects to the PostLoginPage.</p>
</div>
<div class="paragraph">
<p>Here is the code snippet of the UserController.java that handles the login request.</p>
</div>
<div class="listingblock">
<div class="title">UserController.java - login</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/user"</span><span class="o">)</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${app.auth.post-login-redirect}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">postLoginRedirect</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">login</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>

        <span class="k">if</span><span class="o">(</span><span class="n">cookies</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"=====&gt; cookies: {}"</span><span class="o">,</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">cookies</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Redirecting to: {}"</span><span class="o">,</span> <span class="n">postLoginRedirect</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">postLoginRedirect</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/username"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">username</span><span class="o">(</span><span class="nc">Authentication</span> <span class="n">authentication</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"username: {}"</span><span class="o">,</span><span class="n">username</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It redirects to the postLoginRedirect that is PostLoginPage in this case.</p>
</div>
</div>
<div class="sect2">
<h3 id="postloginpage">PostLoginPage</h3>
<div class="paragraph">
<p>PostLoginPage.tsx is the callback page after login. It saves the username and authenticated flag in the local storage and redirects to the HomePage.</p>
</div>
<div class="listingblock">
<div class="title">pages/PostLoginPage.tsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="typescript"><span class="k">import</span> <span class="p">{</span><span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">useNavigate</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-router-dom</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">useLocalStorage</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../hooks/useLocalStorage.tsx</span><span class="dl">"</span><span class="p">;</span>


<span class="kr">interface</span> <span class="nx">UsernameResponseModel</span> <span class="p">{</span>
    <span class="nl">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
<span class="p">}</span>



<span class="kd">function</span> <span class="nf">PostLoginPage</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">const</span> <span class="p">[</span><span class="nx">authenticated</span><span class="p">,</span> <span class="nx">setAuthenticated</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useLocalStorage</span><span class="p">(</span><span class="dl">'</span><span class="s1">authenticated</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">setUsername</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useLocalStorage</span><span class="p">(</span><span class="dl">'</span><span class="s1">username</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>


    <span class="kd">const</span> <span class="p">[</span><span class="nx">loaded</span><span class="p">,</span> <span class="nx">setLoaded</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="c1">// const {setAuthenticated, setUsername} = useContext(AuthContext)</span>
    <span class="kd">const</span> <span class="nx">navigate</span> <span class="o">=</span> <span class="nf">useNavigate</span><span class="p">()</span>

    <span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">loadUsername</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NSA2_GATEWAY_URL</span><span class="p">}</span><span class="s2">/user/username`</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">credentials</span><span class="p">:</span> <span class="dl">"</span><span class="s2">include</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
                    <span class="dl">"</span><span class="s2">Origin</span><span class="dl">"</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ORIGIN</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">})</span>
            <span class="kd">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span> <span class="kd">as </span><span class="nx">UsernameResponseModel</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">const</span> <span class="nx">_username</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">username</span>
                <span class="kd">const</span> <span class="nx">_authenticated</span> <span class="o">=</span> <span class="nx">_username</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">_username</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>

                <span class="nf">setUsername</span><span class="p">(</span><span class="nx">_username</span><span class="p">)</span>
                <span class="nf">setAuthenticated</span><span class="p">(</span><span class="nx">_authenticated</span><span class="p">)</span>

                <span class="nf">setLoaded</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
                <span class="nf">navigate</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">setLoaded</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
                <span class="nf">navigate</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nf">loadUsername</span><span class="p">()</span>



    <span class="c1">// }, [loaded, authenticated, username])</span>
    <span class="p">},</span> <span class="p">[])</span>


    <span class="k">return </span><span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="cm">/*&lt;h1&gt;Post Login Page&lt;/h1&gt;*/</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">PostLoginPage</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once login is successful, the user can access the protected server resources using Session ID cookie. We do not have to know the name of the cookie, but we need to set 'credentials' to 'include' when making a request to the backend server. With this configuration, the browser will send the cookie to the backend server.</p>
</div>
<div class="paragraph">
<p>PostLoginPage calls the /user/username endpoint to get the username of the authenticated user. It saves the username and authenticated flag in the local storage and then redirects to the HomePage.</p>
</div>
</div>
<div class="sect2">
<h3 id="homepage">HomePage</h3>
<div class="paragraph">
<p>HomePage.tsx is a protected page. If the user is not authenticated, the user will be redirected to the login page. It shows the username of the authenticated user. And it has a logout button that redirects to the logout page and a profile button that redirects to the profile page.</p>
</div>
<div class="listingblock">
<div class="title">pages/HomePage.tsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="typescript"><span class="k">import</span> <span class="p">{</span><span class="nx">useLocalStorage</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../hooks/useLocalStorage.tsx</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">useNavigate</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-router-dom</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>


<span class="kr">interface</span> <span class="nx">Csrf</span> <span class="p">{</span>
    <span class="nl">headerName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">parameterName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">token</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">HomePage</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">username</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useLocalStorage</span><span class="p">(</span><span class="dl">'</span><span class="s1">username</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>

    <span class="kd">const</span> <span class="nx">navigate</span> <span class="o">=</span> <span class="nf">useNavigate</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">viewProfile</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">MouseEvent</span><span class="o">&lt;</span><span class="nx">HTMLAnchorElement</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">()</span>

        <span class="nf">navigate</span><span class="p">(</span><span class="dl">'</span><span class="s1">/profile</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">initialCsrf</span> <span class="o">=</span> <span class="p">{</span><span class="na">parameterName</span><span class="p">:</span><span class="dl">''</span><span class="p">,</span> <span class="na">headerName</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">token</span><span class="p">:</span> <span class="dl">''</span><span class="p">}</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">csrf</span><span class="p">,</span> <span class="nx">setCsrf</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="nx">initialCsrf</span><span class="p">)</span>

    <span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="nx">loadCsrf</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://nsa2-gateway:8080/csrf</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">credentials</span><span class="p">:</span> <span class="dl">'</span><span class="s1">include</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
                    <span class="dl">"</span><span class="s2">Origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://nsa2-gateway:3000</span><span class="dl">"</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">})</span>

            <span class="kd">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span> <span class="kd">as </span><span class="nx">Csrf</span>

            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">json: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">json</span><span class="p">)</span>

            <span class="k">if </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">setCsrf</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nf">loadCsrf</span><span class="p">()</span>


    <span class="p">},</span> <span class="p">[])</span>



    <span class="k">return </span><span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">NSA2</span> <span class="nx">Sample</span> <span class="nx">Application</span><span class="o">&lt;</span><span class="sr">/h1&gt;&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Signed</span> <span class="kd">as </span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">#</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">viewProfile</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/a&gt; &lt;/</span><span class="nx">h3</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="p">{</span><span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NSA2_GATEWAY_URL</span><span class="p">}</span><span class="s2">/logout?_csrf=</span><span class="p">${</span><span class="nx">csrf</span><span class="p">.</span><span class="nx">token</span><span class="p">}</span><span class="s2">`</span><span class="p">}</span> <span class="nx">method</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">}</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">input</span> <span class="kd">type</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">SUBMIT</span><span class="dl">'</span><span class="p">}</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">Logout</span><span class="dl">'</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="p">{</span><span class="cm">/*&lt;CsrfProvider csrf={_csrf}&gt;&lt;LogoutForm/&gt;&lt;/CsrfProvider&gt;*/</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">)</span>

<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">HomePage</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It has some codes for CSRF protection and logout. I will cover this later in the article.</p>
</div>
</div>
<div class="sect2">
<h3 id="profilepage">ProfilePage</h3>
<div class="paragraph">
<p>ProfilePage.tsx is a protected page. It displays the user information from ID token which is what we implemented in the previous article.</p>
</div>
<div class="listingblock">
<div class="title">pages/Profile.tsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="typescript"><span class="k">import</span> <span class="p">{</span><span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">useNavigate</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-router-dom</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">useLocalStorage</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../hooks/useLocalStorage.tsx</span><span class="dl">"</span><span class="p">;</span>


<span class="kr">interface</span> <span class="nx">ProfileModel</span> <span class="p">{</span>
    <span class="nl">sub</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">birthdate</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">gender</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">roles</span><span class="p">:</span> <span class="kr">string</span><span class="p">[],</span>
    <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>


<span class="kd">function</span> <span class="nf">ProfilePage</span><span class="p">()</span> <span class="p">{</span>


    <span class="kd">const</span> <span class="nx">navigate</span> <span class="o">=</span> <span class="nf">useNavigate</span><span class="p">();</span>

    <span class="kd">const</span> <span class="nx">goHome</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">MouseEvent</span><span class="o">&lt;</span><span class="nx">HTMLAnchorElement</span><span class="o">&gt;</span><span class="p">)</span><span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">()</span>
        <span class="nf">navigate</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="p">[</span><span class="nx">username</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useLocalStorage</span><span class="p">(</span><span class="dl">'</span><span class="s1">username</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>

    <span class="kd">const</span> <span class="nx">initialProfileModel</span><span class="p">:</span> <span class="nx">ProfileModel</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">sub</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span>
        <span class="na">birthdate</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">gender</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">roles</span><span class="p">:</span> <span class="p">[],</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">''</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="p">[</span><span class="nx">profile</span><span class="p">,</span> <span class="nx">setProfile</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="nx">initialProfileModel</span><span class="p">)</span>

    <span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">loadProfile</span> <span class="o">=</span> <span class="k">async</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NSA2_GATEWAY_URL</span><span class="p">}</span><span class="s2">/user/profile`</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">credentials</span><span class="p">:</span> <span class="dl">'</span><span class="s1">include</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
                    <span class="dl">"</span><span class="s2">Origin</span><span class="dl">"</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ORIGIN</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">})</span>

            <span class="kd">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span> <span class="kd">as </span><span class="nx">ProfileModel</span>

            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">json: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">json</span><span class="p">)</span>

            <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">setProfile</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nf">loadProfile</span><span class="p">()</span>

    <span class="p">},</span> <span class="p">[])</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Profile</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">table</span> <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">400</span><span class="p">}</span> <span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">Username</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">align</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">profile</span><span class="p">.</span><span class="nx">sub</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">Email</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">align</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">profile</span><span class="p">.</span><span class="nx">email</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">Display</span> <span class="nx">name</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">align</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">profile</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nb">Date</span> <span class="k">of</span> <span class="nx">Birth</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">align</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">profile</span><span class="p">.</span><span class="nx">birthdate</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">Gender</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">align</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">profile</span><span class="p">.</span><span class="nx">gender</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">Roles</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">align</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">profile</span><span class="p">.</span><span class="nx">roles</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">, </span><span class="dl">"</span><span class="p">)}</span><span class="o">&lt;</span><span class="sr">/td</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/table</span><span class="err">&gt;
</span>        <span class="p">{</span><span class="cm">/*&lt;form&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;label&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*        Username: &lt;input size={50} name="username" readOnly={true} value={profile.sub}/&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;/label&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;br/&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;label&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*        Display name: &lt;input size={50} name="displayName" readOnly={true} value={profile.name}/&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;/label&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;br/&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;label&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*        Email: &lt;input size={50} name="email" readOnly={true} value={profile.email}/&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;/label&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;br/&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;label&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*        Gender: &lt;input size={50} name="gender" readOnly={true} value={profile.gender}/&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;/label&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;br/&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;label&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*        Date of Birth: &lt;input size={50} name="dob" readOnly={true} value={profile.birthdate}/&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;/label&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*    &lt;br/&gt;*/</span><span class="p">}</span>
        <span class="p">{</span><span class="cm">/*&lt;/form&gt;*/</span><span class="p">}</span>

        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="na">height</span><span class="p">:</span> <span class="mi">40</span><span class="p">}}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">'</span><span class="s1">#</span><span class="dl">'</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">goHome</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Go</span> <span class="nx">Homepage</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">ProfilePage</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It calls the /user/username endpoint to get the details of the authenticated user.</p>
</div>
</div>
<div class="sect2">
<h3 id="postlogoutpage">PostLogoutPage</h3>
<div class="paragraph">
<p>PostLogoutPage.tsx is the callback page after logout. It removes the user information from the local storage and redirects to the LoginPage.</p>
</div>
<div class="listingblock">
<div class="title">pages/PostLogout.tsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="typescript"><span class="k">import</span> <span class="p">{</span><span class="nx">useEffect</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// import {AuthContext, useAuth} from "../hooks/useAuth.tsx";</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useNavigate</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-router-dom</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">useLocalStorage</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../hooks/useLocalStorage.tsx</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">PostLogoutPage</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">authenticated</span><span class="p">,</span> <span class="nx">setAuthenticated</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useLocalStorage</span><span class="p">(</span><span class="dl">'</span><span class="s1">authenticated</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">setUsername</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useLocalStorage</span><span class="p">(</span><span class="dl">'</span><span class="s1">username</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>

    <span class="kd">const</span> <span class="nx">navigate</span> <span class="o">=</span> <span class="nf">useNavigate</span><span class="p">()</span>

    <span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nf">setAuthenticated</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
        <span class="nf">setUsername</span><span class="p">(</span><span class="dl">''</span><span class="p">)</span>

        <span class="nf">navigate</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">)</span>

    <span class="p">},</span> <span class="p">[])</span>

    <span class="k">return </span><span class="p">(</span><span class="o">&lt;&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Logged</span> <span class="nx">out</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">PostLogoutPage</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="screenshots">Screenshots</h3>
<div class="paragraph">
<p>Here are some screenshots of the application.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/react-login.png" alt="React Login Page">
</div>
<div class="title">Figure 1. Login Page</div>
</div>
<div class="paragraph">
<p>We can see that the login page is provided by the Spring Authorization Server.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/react-home.png" alt="React Home Page">
</div>
<div class="title">Figure 2. Home Page</div>
</div>
<div class="paragraph">
<p>Now the React application can access the protected resources. The username is displayed on the screen.</p>
</div>
<div class="paragraph">
<p>When the user clicks the Profile button, it redirects to the Profile page.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/react-profile.png" alt="React Profile Page">
</div>
</div>
<div class="paragraph">
<p>The user information is displayed on the Profile page.</p>
</div>
<div class="paragraph">
<p>Because the user profile has roles, we can use the roles to control the access to the resources.</p>
</div>
<div class="paragraph">
<p>So far, we have implemented the login, logout, and profile pages. We are going to cover the logout and CSRF protection in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="logout">Logout</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>call /logout endpoint of the Spring Cloud Gateway</p>
</li>
<li>
<p>It clears ID token and Access token from the Session Store in server side</p>
</li>
<li>
<p>It redirects to /logged-out of the Spring Cloud Gateway by configuration</p>
</li>
<li>
<p>/logged-out redirects to the PostLogoutPage so that React application can remove the user information from the local storage</p>
</li>
<li>
<p>PostLogoutPage remove the user information from the local storage and redirects to the LoginPage</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information, see the following links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-security/reference/servlet/authentication/logout.html" class="bare">https://docs.spring.io/spring-security/reference/servlet/authentication/logout.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="csrf-protection">CSRF Protection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To call /logout endpoint, we need to add CSRF token in the request header or parameter. We could disable CSRF protection, but it is not recommended. Instead, we can get the CSRF token from the server and add it to the request header or parameter.</p>
</div>
<div class="paragraph">
<p>If we call /logout without CSRF token, we will return 403 Forbidden.</p>
</div>
<div class="paragraph">
<p>Here is the sample response of the /logout endpoint without CSRF token.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="o">{</span>
    <span class="s2">"timestamp"</span>: <span class="s2">"2024-10-14T08:36:03.448+00:00"</span>,
    <span class="s2">"status"</span>: 403,
    <span class="s2">"error"</span>: <span class="s2">"Forbidden"</span>,
    <span class="s2">"path"</span>: <span class="s2">"/logout"</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The official documentation of Spring Authorization Server suggests a few ways to handle CSRF protection from Sigle Page Application(SPA).</p>
</div>
<div class="paragraph">
<p>Please refer to the following link for more information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-security/reference/servlet/exploits/csrf.html" class="bare">https://docs.spring.io/spring-security/reference/servlet/exploits/csrf.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I tried to implement the CSRF protection in the React application. I will cover this in the next section.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>using Cookie - it does not work as it expected</p>
</li>
<li>
<p>calling /csrf endpoint - it works as expected</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So, in this article, we are going to call /csrf endpoint to get the CSRF token.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the code snippet of the Logout related code in the Home.tsx.</p>
</div>
<div class="listingblock">
<div class="title">pages/Home.tsx - Logout related code</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="typescript"><span class="kr">interface</span> <span class="nx">Csrf</span> <span class="p">{</span>
    <span class="nl">headerName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">parameterName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">token</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">HomePage</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">const</span> <span class="nx">initialCsrf</span> <span class="o">=</span> <span class="p">{</span><span class="na">parameterName</span><span class="p">:</span><span class="dl">''</span><span class="p">,</span> <span class="na">headerName</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">token</span><span class="p">:</span> <span class="dl">''</span><span class="p">}</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">csrf</span><span class="p">,</span> <span class="nx">setCsrf</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="nx">initialCsrf</span><span class="p">)</span>

    <span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="nx">loadCsrf</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://nsa2-gateway:8080/csrf</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">credentials</span><span class="p">:</span> <span class="dl">'</span><span class="s1">include</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
                    <span class="dl">"</span><span class="s2">Origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://nsa2-gateway:3000</span><span class="dl">"</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">})</span>

            <span class="kd">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span> <span class="kd">as </span><span class="nx">Csrf</span>

            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">json: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">json</span><span class="p">)</span>

            <span class="k">if </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">setCsrf</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nf">loadCsrf</span><span class="p">()</span>

    <span class="p">},</span> <span class="p">[])</span>

    <span class="k">return </span><span class="p">(</span>
        <span class="c1">// omitted for brevity</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="p">{</span><span class="s2">`http://nsa2-gateway:8080/logout?_csrf=</span><span class="p">${</span><span class="nx">csrf</span><span class="p">.</span><span class="nx">token</span><span class="p">}</span><span class="s2">`</span><span class="p">}</span> <span class="nx">method</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">}</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">input</span> <span class="kd">type</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">SUBMIT</span><span class="dl">'</span><span class="p">}</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">Logout</span><span class="dl">'</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">)</span>

<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It calls /csrf endpoint to get the CSRF token. And it adds the CSRF token to the request parameter when calling /logout endpoint with the POST method. The parameter name is '_csrf'.</p>
</div>
<div class="paragraph">
<p>Here is a sample response of the /csrf endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"parameterName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"_csrf"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"headerName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"X-XSRF-TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"QOcJRqNRTAm7C1Hlo34YQoW8V3zHYiC2bnifFani8hEK5mOTcoZrf8U1LTuWMmTcklMsdLOMeh2iVRibCEGvJJjVwiNuglSj"</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="csrfcontroller">CsrfController</h3>
<div class="paragraph">
<p>CsrfController.java is a simple controller that returns the CSRF token for the client.</p>
</div>
<div class="listingblock">
<div class="title">CsrfController.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CsrfController</span> <span class="o">{</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/csrf"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CsrfToken</span> <span class="nf">csrf</span><span class="o">(</span><span class="nc">CsrfToken</span> <span class="n">csrfToken</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">csrfToken</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-configuration-on-spring-cloud-gateway">Security Configuration on Spring Cloud Gateway</h3>
<div class="listingblock">
<div class="title">GatewaySecurityConfig.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Configuration</span><span class="o">(</span><span class="n">proxyBeanMethods</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="nd">@EnableWebSecurity</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GatewaySecurityConfig</span> <span class="o">{</span>
    <span class="c1">// @formatter:off</span>
    <span class="nd">@Bean</span>
    <span class="nd">@Order</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">SecurityFilterChain</span> <span class="nf">securityFilterChain</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">,</span> <span class="nc">ClientRegistrationRepository</span> <span class="n">clientRegistrationRepository</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">addFilterBefore</span><span class="o">(</span><span class="k">new</span> <span class="nc">CorsFilter</span><span class="o">(),</span> <span class="nc">ChannelProcessingFilter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">authorizeHttpRequests</span><span class="o">(</span><span class="n">authorize</span> <span class="o">-&gt;</span>
                <span class="n">authorize</span>
                    <span class="o">.</span><span class="na">requestMatchers</span><span class="o">(</span><span class="s">"/jwks"</span><span class="o">,</span> <span class="s">"/logged-out"</span><span class="o">,</span> <span class="s">"/login/oauth2/code/nsa2"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">requestMatchers</span><span class="o">(</span><span class="s">"/actuator/health"</span><span class="o">,</span> <span class="s">"/actuator/health/liveness"</span><span class="o">,</span> <span class="s">"/actuator/health/readiness"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
            <span class="o">)</span>


            <span class="o">.</span><span class="na">oauth2Login</span><span class="o">(</span><span class="n">oauth2Login</span> <span class="o">-&gt;</span>
                <span class="n">oauth2Login</span><span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">"/oauth2/authorization/nsa2"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">oauth2Client</span><span class="o">(</span><span class="nc">Customizer</span><span class="o">.</span><span class="na">withDefaults</span><span class="o">())</span>
            <span class="c1">// logout configuration</span>
            <span class="o">.</span><span class="na">logout</span><span class="o">(</span><span class="n">logout</span><span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">logout</span><span class="o">.</span><span class="na">logoutUrl</span><span class="o">(</span><span class="s">"/logout"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">logoutSuccessHandler</span><span class="o">(</span><span class="n">oidcLogoutSuccessHandler</span><span class="o">(</span><span class="n">clientRegistrationRepository</span><span class="o">));</span>
            <span class="o">});</span>

            <span class="c1">// This is not working as expected</span>
<span class="c1">//        http.csrf(csrf -&gt; csrf</span>
<span class="c1">//                .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())</span>
<span class="c1">//                .csrfTokenRequestHandler(new SpaCsrfTokenRequestHandler())</span>
<span class="c1">//        );</span>

        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">// @formatter:on</span>

    <span class="kd">private</span> <span class="nc">LogoutSuccessHandler</span> <span class="nf">oidcLogoutSuccessHandler</span><span class="o">(</span><span class="nc">ClientRegistrationRepository</span> <span class="n">clientRegistrationRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">OidcClientInitiatedLogoutSuccessHandler</span> <span class="n">oidcLogoutSuccessHandler</span> <span class="o">=</span>
                <span class="k">new</span> <span class="nf">OidcClientInitiatedLogoutSuccessHandler</span><span class="o">(</span><span class="n">clientRegistrationRepository</span><span class="o">);</span>

        <span class="c1">// Set the location that the End-User's User Agent will be redirected to</span>
        <span class="c1">// after the logout has been performed at the Provider</span>
        <span class="n">oidcLogoutSuccessHandler</span><span class="o">.</span><span class="na">setPostLogoutRedirectUri</span><span class="o">(</span><span class="s">"{baseUrl}/logged-out"</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">oidcLogoutSuccessHandler</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the GatewaySecurityConfig.java, we have the following configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/logged-out is permitted for all</p>
</li>
<li>
<p>/logout is configured to use the oidcLogoutSuccessHandler</p>
</li>
<li>
<p>{baseUrl}/logged-out is the post logout redirect URI</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">LogoutController.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Controller</span>
<span class="nd">@Slf4j</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">""</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogoutController</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${app.auth.post-logout-redirect}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">postLogoutRedirect</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/logged-out"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">loggedOut</span><span class="o">(</span><span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"logged-out"</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"postLogoutRedirect: {}"</span><span class="o">,</span> <span class="n">postLogoutRedirect</span><span class="o">);</span>

        <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">postLogoutRedirect</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>/logged-out is the callback page after logout. It redirects to the postLogoutRedirect that is the PostLogoutPage in this case.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this article, we have implemented the login, logout, and profile pages. We have also implemented the CSRF protection in the React application. We have used the CSRF token from the server to call the /logout endpoint.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://medium.com/@meetwithIT/how-to-you-use-tailwind-css-free-654bb2a448a1" class="bare">https://medium.com/@meetwithIT/how-to-you-use-tailwind-css-free-654bb2a448a1</a></p>
</li>
<li>
<p><a href="https://tailwindui.com/documentation" class="bare">https://tailwindui.com/documentation</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="youtube">Youtube</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=wazIwLjh-h8" class="bare">https://www.youtube.com/watch?v=wazIwLjh-h8</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
        </div>
    </main>
</div>




<script>
    const toc = document.getElementById('toc');
    const container = document.getElementById('toc-container');
    if (toc && container) {
        container.appendChild(toc);
    }
</script>


<!--<button onclick="toggleTheme()" style="position: fixed; bottom: 1rem; right: 1rem; padding: 0.5rem 1rem; background-color: var(&#45;&#45;link); color: white; border: none; border-radius: 0.375rem; cursor: pointer;">-->
<!--    Toggle Theme-->
<!--</button>-->

<!--<script>-->
<!--    function toggleTheme() {-->
<!--        const html = document.documentElement;-->
<!--        const isDark = html.getAttribute("data-theme") === "dark";-->
<!--        html.setAttribute("data-theme", isDark ? "light" : "dark");-->
<!--        localStorage.setItem("theme", isDark ? "light" : "dark");-->
<!--    }-->

<!--    document.addEventListener("DOMContentLoaded", () => {-->
<!--        const savedTheme = localStorage.getItem("theme") || "light";-->
<!--        document.documentElement.setAttribute("data-theme", savedTheme);-->
<!--    });-->
<!--</script>-->

<!-- Footer -->
<footer class="bg-gray-900 text-white text-sm py-6 text-center">
     2025 Service Foundry. All rights reserved.
</footer>
</body>
</html>
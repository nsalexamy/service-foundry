<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Enable TLS/SSL with Let&#8217;s Encrypt</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        body {
            font-family: sans-serif;
            background-color: #f8fafc;
            color: #1f2937;
            margin: 0;
            padding: 0;
        }
    </style>
    
</head>
<body>
<div id="toc" class="toc">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a></li>
<li><a href="#dns-configuration">DNS Configuration</a></li>
<li><a href="#clusterissuer">ClusterIssuer</a></li>
<li><a href="#create-a-certificate-resource">Create a Certificate resource</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="overview">Overview</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="dns-configuration">DNS Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Type: A
Name: @
Value: WebsiteBuilder Site
TTL: 1 Hour</p>
</div>
<div class="paragraph">
<p>Value: &lt;IP_ADDRESS_OF_YOUR_LOAD_BALANCER&gt;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="clusterissuer">ClusterIssuer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, create a ClusterIssuer resource for the CA-based certificates.</p>
</div>
<div class="listingblock">
<div class="title">clusterissuer-letsencrypt-http.yaml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">cert-manager.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterIssuer</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">letsencrypt-http</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cert-manager</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">acme</span><span class="pi">:</span>
    <span class="c1"># Your contact email (used for renewal notices)</span>
    <span class="na">email</span><span class="pi">:</span> <span class="s">credemol@gmail.com</span>

    <span class="c1"># Letâ€™s Encrypt production server</span>
    <span class="c1"># For testing, use: https://acme-staging-v02.api.letsencrypt.org/directory</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s">https://acme-v02.api.letsencrypt.org/directory</span>

    <span class="c1"># Secret where the ACME account private key is stored</span>
    <span class="na">privateKeySecretRef</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">letsencrypt-http-key</span>

    <span class="c1"># Use HTTP-01 challenge via Traefik ingress</span>
    <span class="na">solvers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">http01</span><span class="pi">:</span>
          <span class="na">ingress</span><span class="pi">:</span>
            <span class="na">class</span><span class="pi">:</span> <span class="s">traefik</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply the ClusterIssuer resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> clusterissuer-letsencrypt-http.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>It generates TLS private key in the secret <code>letsencrypt-http-private-key</code> in the <code>cert-manager</code> namespace.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-a-certificate-resource">Create a Certificate resource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next, create a Certificate resource to request a TLS certificate for your domain.</p>
</div>
<div class="listingblock">
<div class="title">certificate-servicefoundry.yaml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">cert-manager.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Certificate</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">servicefoundry-ca-cert</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">service-foundry</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">secretName</span><span class="pi">:</span> <span class="s">servicefoundry-ca-tls</span>
  <span class="na">issuerRef</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">letsencrypt-http</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterIssuer</span>
  <span class="na">commonName</span><span class="pi">:</span> <span class="s">servicefoundry.ca</span>
  <span class="na">dnsNames</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">servicefoundry.ca</span>
    <span class="c1">#- '*.servicefoundry.ca'</span>
    <span class="c1">#- www.servicefoundry.ca</span>
    <span class="pi">-</span> <span class="s">sfapp.servicefoundry.ca</span>
    <span class="c1">#- sfapp-backend.servicefoundry.ca</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply the Certificate resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> certificate-servicefoundry.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a TLS certificate for <code>servicefoundry.ca</code> and <code>*.servicefoundry.ca</code>, stored in the secret <code>servicefoundry-tls</code> in the <code>cert-manager</code> namespace.</p>
</div>
</div>
</div>
</body>
</html>
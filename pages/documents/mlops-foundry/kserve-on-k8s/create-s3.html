<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Page Not Found</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        body {
            font-family: sans-serif;
            background-color: #f8fafc;
            color: #1f2937;
            margin: 0;
            padding: 0;
        }
    </style>
    
</head>
<body>
<div id="toc" class="toc">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#s3-configuration">S3 Configuration</a>
<ul class="sectlevel2">
<li><a href="#step-1-create-an-aws-s3-bucket">Step 1: Create an AWS S3 Bucket</a></li>
<li><a href="#step-2-create-an-aws-iam-user-and-policy">Step 2: Create an AWS IAM User and Policy</a></li>
</ul>
</li>
<li><a href="#step-3-create-a-kubernetes-secret">Step 3: Create a Kubernetes Secret</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="s3-configuration">S3 Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="step-1-create-an-aws-s3-bucket">Step 1: Create an AWS S3 Bucket</h3>
<div class="paragraph">
<p>Configure the following variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">BUCKET_NAME</span><span class="o">=</span>nsa2-sf-ml-models
<span class="nv">POLICY_NAME</span><span class="o">=</span>MlModelStoragePolicy
<span class="nv">SID</span><span class="o">=</span>MlModelStorageAccess
<span class="c"># Use whatever you want for the following variables</span>
<span class="nv">IAM_USER_NAME</span><span class="o">=</span>mlops
<span class="nv">K8S_SECRET_NAME</span><span class="o">=</span>mlops-aws-credentials
<span class="nv">NAMESPACE</span><span class="o">=</span>kserve</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a dedicated S3 bucket for Longhorn backups:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the <strong>AWS Management Console</strong> and navigate to <strong>S3</strong>.</p>
</li>
<li>
<p>Click <strong>Create bucket</strong>.</p>
</li>
<li>
<p>Enter a unique <strong>Bucket name</strong> (e.g., <code>your-bucket-name</code>).</p>
<div class="ulist">
<ul>
<li>
<p>Use lowercase letters, numbers, and hyphens only.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Select an <strong>AWS Region</strong> close to your cluster (e.g., <code>us-east-1</code>).</p>
<div class="ulist">
<ul>
<li>
<p>For disaster recovery, consider a region different from your cluster location.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Leave <strong>Block all public access</strong> enabled.</p>
</li>
<li>
<p>Click <strong>Create bucket</strong>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Note the <strong>Bucket Name</strong> and <strong>Region</strong> for later configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="step-2-create-an-aws-iam-user-and-policy">Step 2: Create an AWS IAM User and Policy</h3>
<div class="paragraph">
<p>KServe needs permission to access the S3 bucket. It is best practice to create a dedicated IAM user with restricted permissions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On Production, we should use IAM Roles for Service Accounts (IRSA) instead of IAM users with static credentials. IRSA provides temporary, automatically rotated credentials and is more secure than long-lived access keys.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="2-1-create-an-iam-policy">2.1 Create an IAM Policy</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>IAM</strong> in the AWS Console.</p>
</li>
<li>
<p>Click <strong>Policies</strong> &#8594; <strong>Create policy</strong>.</p>
</li>
<li>
<p>Select the <strong>JSON</strong> tab and paste the following policy (replace <code>&lt;your-bucket-name&gt;</code>):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Create MlModelStoragePolicy.json</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt; </span><span class="k">${</span><span class="nv">POLICY_NAME</span><span class="k">}</span><span class="sh">.json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "</span><span class="k">${</span><span class="nv">SID</span><span class="k">}</span><span class="sh">",
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:ListBucket",
                "s3:DeleteObject"
            ],
            "Resource": [
                "arn:aws:s3:::</span><span class="k">${</span><span class="nv">BUCKET_NAME</span><span class="k">}</span><span class="sh">",
                "arn:aws:s3:::</span><span class="k">${</span><span class="nv">BUCKET_NAME</span><span class="k">}</span><span class="sh">/*"
            ]
        }
    ]
}
EOF</span></code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Next</strong>, name the policy <code>MlModelStoragePolicy</code>, and click <strong>Create policy</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="2-2-create-an-iam-user">2.2 Create an IAM User</h4>
<div class="paragraph">
<p>With the policy created, the next step is to create a dedicated IAM user that will use this policy. This user represents the "identity" that Longhorn will assume when interacting with S3.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In production environments, consider using <strong>IAM Roles for Service Accounts (IRSA)</strong> instead of IAM users with static credentials. IRSA provides temporary, automatically rotated credentials and is more secure than long-lived access keys. However, for simplicity and compatibility with all Kubernetes distributions, this guide uses IAM users. See the IRSA implementation guide for production-grade authentication.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Detailed Steps:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Access IAM Users</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Navigate to <strong>Users</strong> in the IAM console.</p>
</li>
<li>
<p>Click <strong>Create user</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Configure User Identity</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Enter a descriptive <strong>User name</strong>: <code>${IAM_USER_NAME}</code></p>
</li>
<li>
<p>This name is purely for identification—it doesn&#8217;t need to match anything in Kubernetes.</p>
</li>
<li>
<p>Do <strong>not</strong> enable "Provide user access to the AWS Management Console"—this is a programmatic-only user with no login capabilities.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Click Next</strong> to proceed to permissions.</p>
</li>
<li>
<p><strong>Attach the Policy</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Select <strong>Attach policies directly</strong>.</p>
</li>
<li>
<p>In the search box, type <code>${POLICY_NAME}</code> (the policy you created earlier).</p>
</li>
<li>
<p>Check the box next to your policy to select it.</p>
</li>
<li>
<p>Verify that only this one policy is selected.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Review and Create</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Next</strong> to review.</p>
</li>
<li>
<p>Verify the policy attachment is correct.</p>
</li>
<li>
<p>Click <strong>Create user</strong> to finalize.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="2-3-create-access-keys">2.3 Create Access Keys</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on the newly created user to open user details.</p>
</li>
<li>
<p>Go to the <strong>Security credentials</strong> tab.</p>
</li>
<li>
<p>Under <strong>Access keys</strong>, click <strong>Create access key</strong>.</p>
</li>
<li>
<p>Select <strong>Third-party service</strong> &#8594; <strong>Next</strong> &#8594; <strong>Create access key</strong>.</p>
</li>
<li>
<p><strong>Save the Access key ID and Secret access key</strong> (you cannot retrieve the secret later).</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Never commit these credentials to Git. For production, consider IAM Roles for Service Accounts (IRSA) or rotate keys every 90 days.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step-3-create-a-kubernetes-secret">Step 3: Create a Kubernetes Secret</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Store AWS credentials in a Kubernetes secret so KServe can access S3.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Set environment variables with your AWS credentials</span>
<span class="nv">MLOPS_AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s2">"your-access-key-id"</span>
<span class="nv">MLOPS_AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s2">"your-secret-access-key"</span>

<span class="c"># Create the secret in kserve namespace</span>
kubectl create secret generic <span class="nv">$K8S_SECRET_NAME</span> <span class="se">\</span>
  <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="se">\</span>
  <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="k">${</span><span class="nv">MLOPS_AWS_ACCESS_KEY_ID</span><span class="k">}</span> <span class="se">\</span>
  <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="k">${</span><span class="nv">MLOPS_AWS_SECRET_ACCESS_KEY</span><span class="k">}</span> <span class="se">\</span>
  <span class="nt">--dry-run</span><span class="o">=</span>client <span class="nt">-o</span> yaml <span class="o">&gt;</span> <span class="nv">$K8S_SECRET_NAME</span>.yaml

<span class="c"># Verify the secret was created</span>
kubectl get secret <span class="nv">$K8S_SECRET_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span>

<span class="c"># Clean up environment variables</span>
<span class="nb">unset </span>AWS_ACCESS_KEY_ID
<span class="nb">unset </span>AWS_SECRET_ACCESS_KEY</code></pre>
</div>
</div>
<div class="paragraph">
<p>Seal the secret</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># This is a simple custom script to seal all secrets in a directory passed as an argument</span>
<span class="nv">$ </span>apply-sealed-secret ./</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now it is safe to commit to Git.</p>
</div>
<div class="listingblock">
<div class="title">mlops-aws-credentials.yaml - sealed secret</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">bitnami.com/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">SealedSecret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">creationTimestamp</span><span class="pi">:</span> <span class="kc">null</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mlops-aws-credentials</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kserve</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">encryptedData</span><span class="pi">:</span>
    <span class="na">AWS_ACCESS_KEY_ID</span><span class="pi">:</span> <span class="s">AgCd8Cquw0n...MqnVEodw==</span>
    <span class="na">AWS_SECRET_ACCESS_KEY</span><span class="pi">:</span> <span class="s">AgAxcpMFlQES...VVAtJz</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">creationTimestamp</span><span class="pi">:</span> <span class="kc">null</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">mlops-aws-credentials</span>
      <span class="na">namespace</span><span class="pi">:</span> <span class="s">kserve</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply the sealed secret</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> mlops-aws-credentials.yaml</code></pre>
</div>
</div>
</div>
</div>
</body>
</html>
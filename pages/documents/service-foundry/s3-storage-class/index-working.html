<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AWS S3 Storage Class for Service Foundry</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        body {
            font-family: sans-serif;
            background-color: #f8fafc;
            color: #1f2937;
            margin: 0;
            padding: 0;
        }
    </style>
    
</head>
<body>
<div id="toc" class="toc">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#use-case-scenario">Use Case Scenario</a></li>
</ul>
</li>
<li><a href="#install-the-s3-csi-driver">Install the S3 CSI Driver</a></li>
<li><a href="#grant-the-node-iam-role-s3-access">Grant the Node IAM Role S3 Access</a></li>
<li><a href="#resources">Resources</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="overview">Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="use-case-scenario">Use Case Scenario</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Upload NYC Open Data to S3 Bucket with prefix 'nyc-open-data/'</p>
</li>
<li>
<p>Enable S3 CSI Driver and Create S3 Storage Class</p>
</li>
<li>
<p>Create Persistent Volume with S3 Storage Class using S3 Bucket and Prefix</p>
</li>
<li>
<p>Create Persistent Volume Claim to use the Persistent Volume</p>
</li>
<li>
<p>Deploy a Python Pod to load data from S3 using the PVC to PostgreSQL</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="install-the-s3-csi-driver">Install the S3 CSI Driver</h2>
<div class="sectionbody">
<div class="imageblock img-wide">
<div class="content">
<img src="images/console-storage-classes.png" alt="console storage classes">
</div>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/console-storage-classes-s3-sc.png" alt="console storage classes s3 sc">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="grant-the-node-iam-role-s3-access">Grant the Node IAM Role S3 Access</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
see create-s3-sc.sh
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find the IAM role attached to your EKS nodes:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ EKS_NODE_ROLE</span><span class="o">=</span><span class="si">$(</span>aws eks describe-nodegroup <span class="nt">--cluster-name</span> <span class="nv">$EKS_CLUSTER_NAME</span> <span class="nt">--nodegroup-name</span> nsa2-sf-ng-0 <span class="nt">--region</span> <span class="nv">$AWS_REGION</span> <span class="nt">--query</span> <span class="s1">'nodegroup.nodeRole'</span> <span class="nt">--output</span> text | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'/'</span> <span class="nt">-f2</span><span class="si">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$EKS_NODE_ROLE</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/awslabs/mountpoint-s3-csi-driver/blob/main/docs/INSTALL.md" class="bare">https://github.com/awslabs/mountpoint-s3-csi-driver/blob/main/docs/INSTALL.md</a></p>
</li>
</ul>
</div>
</div>
</div>
</body>
</html>
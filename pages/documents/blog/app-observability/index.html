<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Application Observability with OpenTelemetry</title>
    <!-- rouge source highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/service-foundry/pages/assets/css/main.css">

    <!-- Highlight.js script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</head>
<body class="">

<!-- Header -->
<header>
<!--    <div class="logo text-xl font-semibold">Service Foundry</div>-->
    <a href="/service-foundry/pages/index.html" class="text-2xl font-semibold hover:text-teal-400">Service Foundry</a>
    <nav>
    
        
        <a href="/service-foundry/pages/getting-started/" class="">Getting Started</a>
    
        
        <a href="/service-foundry/pages/documents/" class="active">Docs</a>
    
        
        <a href="/service-foundry/pages/github/" class="">GitHub</a>
    
        
        <a href="/service-foundry/pages/developers/" class="">Developers</a>
    
</nav>
</header>

<!-- Sub-navigation for Foundries -->
<div class="subnav">

    
    <a href="/service-foundry/pages/documents/blog/" class="active">Blog</a>

    
    <a href="/service-foundry/pages/documents/infra-foundry/" class="">Infra</a>

    
    <a href="/service-foundry/pages/documents/sso-foundry/" class="">SSO</a>

    
    <a href="/service-foundry/pages/documents/o11y-foundry/" class="">Observability</a>

    
    <a href="/service-foundry/pages/documents/backend-foundry/" class="">Backend</a>

    
    <a href="/service-foundry/pages/documents/bigdata-foundry/" class="">Big Data</a>

<!--    <a href="/service-foundry/pages/documents/infra-foundry/index-backup.html" class="text-gray-300 hover:text-white">Infra</a>-->
<!--    <a href="/service-foundry/pages/documents/sso-foundry/index-backup.html" class="text-gray-300 hover:text-white">SSO</a>-->
<!--    <a href="/service-foundry/pages/documents/o11y-foundry/index-backup.html" class="text-gray-300 hover:text-white">Observability</a>-->
<!--    <a href="/service-foundry/pages/documents/backend-foundry/index-backup.html" class="text-gray-300 hover:text-white">Backend</a>-->
<!--    <a href="/service-foundry/pages/documents/bigdata-foundry/index-backup.html" class="text-gray-300 hover:text-white">Big Data</a>-->
</div>




<!-- Breadcrumb -->

    <nav class="breadcrumb-wrapper">
    <ol class="breadcrumb">
        
        <li>
            
            <a href="/service-foundry/pages/">Home</a>
            
            
            <span class="separator">/</span>
            
        </li>
        
        <li>
            
            <a href="/service-foundry/pages/documents/">Docs</a>
            
            
            <span class="separator">/</span>
            
        </li>
        
        <li>
            
            <a href="/service-foundry/pages/documents/blog/">Blog</a>
            
            
        </li>
        
    </ol>
</nav>





<!-- Main Layout -->
<div class="container">


    <nav id="toc-container" class="toc-nav"></nav>


    <main id="main-content">
        
        <div class="author-box">
            Young Gyu Kim
            &lt;<a href="mailto:credemol@gmail.com" style="color: #0d9488; text-decoration: none;">credemol@gmail.com</a>&gt;
        </div>
        

        <!-- Title -->
        
        <h1 class="page-title">
            Application Observability with OpenTelemetry
        </h1>
        

        <div class="asciidoc">
            <div id="toc" class="toc">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#what-is-application-observability">What is Application Observability?</a></li>
<li><a href="#what-is-opentelemetry">What is OpenTelemetry?</a></li>
<li><a href="#key-components-of-application-observability">Key Components of Application Observability</a></li>
</ul>
</li>
<li><a href="#sample-spring-boot-application-with-opentelemetry">Sample Spring Boot Application with OpenTelemetry</a>
<ul class="sectlevel2">
<li><a href="#setting-environment-variables-for-opentelemetry">Setting Environment Variables for OpenTelemetry</a></li>
<li><a href="#explanation-of-each-variable">Explanation of Each Variable</a></li>
<li><a href="#data-flow-for-observability-components">Data flow for Observability Components</a></li>
</ul>
</li>
<li><a href="#testing-the-sample-application">Testing the Sample Application</a>
<ul class="sectlevel2">
<li><a href="#call-the-sample-application">Call the sample application</a></li>
<li><a href="#call-metrics-endpoint">Call metrics endpoint</a></li>
</ul>
</li>
<li><a href="#traces-in-jaeger">Traces in Jaeger</a></li>
<li><a href="#logs-in-opensearch">Logs in OpenSearch</a></li>
<li><a href="#metrics-in-prometheus">Metrics in Prometheus</a></li>
<li><a href="#metrics-in-grafana">Metrics in Grafana</a></li>
<li><a href="#required-resources-to-run-an-observability-platform-on-kubernetes">Required Resources to Run an Observability Platform on Kubernetes</a>
<ul class="sectlevel2">
<li><a href="#resource-utilization-example-idle-state">Resource Utilization Example (Idle State)</a></li>
<li><a href="#explanation-of-components">Explanation of Components</a></li>
<li><a href="#minimum-node-requirements">Minimum Node Requirements</a></li>
<li><a href="#important-considerations">Important Considerations</a></li>
</ul>
</li>
<li><a href="#application-observability-with-opentelemetry-for-developers">Application Observability with OpenTelemetry for Developers</a>
<ul class="sectlevel2">
<li><a href="#why-monitoring-matters-during-development">Why Monitoring Matters During Development</a></li>
<li><a href="#how-opentelemetry-helps">How OpenTelemetry Helps</a></li>
<li><a href="#example-use-case">Example Use Case</a></li>
<li><a href="#how-to-set-up-opentelemetry-for-local-development">How to set up OpenTelemetry for local development</a></li>
<li><a href="#logs-and-traces">Logs and Traces</a></li>
<li><a href="#metrics-collection-limitation">Metrics Collection Limitation</a></li>
<li><a href="#benefits-for-developers">Benefits for Developers</a></li>
<li><a href="#setting-environment-variables-for-opentelemetry-instrumentation-on-local-machines">Setting Environment Variables for OpenTelemetry Instrumentation on Local Machines</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="imageblock img-wide">
<div class="content">
<img src="images/application-observability-intro.png" alt="application observability intro">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="https://www.linkedin.com/pulse/service-foundry-observability-young-gyu-kim-fqryc/">the previous article</a>, we explored how the ‘Service Foundry for Observability’ can help you build your own observability platform. As a follow-up, this article will focus on the key components of application observability and how OpenTelemetry can help you achieve comprehensive insights into your systems.</p>
</div>
<div class="sect2">
<h3 id="what-is-application-observability">What is Application Observability?</h3>
<div class="paragraph">
<p>Application observability refers to the ability to understand a system’s internal state by analyzing its outputs. It plays a critical role in modern software development and operations, enabling teams to monitor, troubleshoot, and optimize applications efficiently. Essentially, it measures how well a system’s internal workings can be inferred from its external outputs.</p>
</div>
</div>
<div class="sect2">
<h3 id="what-is-opentelemetry">What is OpenTelemetry?</h3>
<div class="paragraph">
<p>OpenTelemetry is an open-source observability framework designed for cloud-native applications. It offers a unified set of APIs, libraries, agents, and instrumentation to capture distributed traces, metrics, and logs from applications, making it easier to monitor and understand complex systems.</p>
</div>
</div>
<div class="sect2">
<h3 id="key-components-of-application-observability">Key Components of Application Observability</h3>
<div class="paragraph">
<p>Achieving robust application observability involves collecting and analyzing data from various sources. Below are the essential components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenTelemetry(OTEL)</p>
<div class="ulist">
<ul>
<li>
<p>OpenTelemetry Collector</p>
</li>
<li>
<p>OpenTelemetry Target Allocator</p>
</li>
<li>
<p>OpenTelemetry Instrumentation</p>
</li>
</ul>
</div>
</li>
<li>
<p>OpenSearch</p>
</li>
<li>
<p>OpenSearch Dashboards</p>
</li>
<li>
<p>Data Prepper</p>
</li>
<li>
<p>Jaeger</p>
</li>
<li>
<p>Prometheus</p>
</li>
<li>
<p>Grafana</p>
</li>
<li>
<p>Cassandra</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Service Foundry for Observability provides a comprehensive set of tools and services to help you set up, configure, and manage these components, empowering your team to gain deeper insights and maintain high system reliability.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sample-spring-boot-application-with-opentelemetry">Sample Spring Boot Application with OpenTelemetry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To help you understand how OpenTelemetry can be used to monitor a Spring Boot application, 'Service Foundry for Observability' provides a sample application that demonstrates how to instrument a Spring Boot application with OpenTelemetry Java SDK. The sample application exposes a simple REST API service with two endpoints:</p>
</div>
<div class="paragraph">
<p>/otel: This endpoint makes 3 to 5 calls to the /sleep/{seconds} endpoint, with a random sleep duration between 1 to 5 seconds for each call.</p>
</div>
<div class="paragraph">
<p>/sleep/{seconds}: This endpoint pauses for the specified number of seconds before returning a response and generates logs during its execution.</p>
</div>
<div class="paragraph">
<p>After making several requests to the /otel endpoint, we will observe how OpenTelemetry captures traces and logs from the application. For metrics, we will use the OpenTelemetry Target Allocator to collect application metrics and forward them to Prometheus.</p>
</div>
<div class="sect2">
<h3 id="setting-environment-variables-for-opentelemetry">Setting Environment Variables for OpenTelemetry</h3>
<div class="paragraph">
<p>To enable OpenTelemetry instrumentation for the sample application, you need to configure specific environment variables. These variables instruct the application on how to capture and send logs, traces, and metrics to the observability system.</p>
</div>
<div class="listingblock">
<div class="title">Required Environment Variables</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">JAVA_TOOL_OPTIONS</span><span class="o">=</span><span class="s2">"-javaagent:/usr/app/javaagent/opentelemetry-javaagent.jar"</span>
<span class="nv">OTEL_EXPORTER_OTLP_ENDPOINT</span><span class="o">=</span>http://otel-collector:4318
<span class="nv">OTEL_LOGS_EXPORTER</span><span class="o">=</span>otlp
<span class="nv">OTEL_METRICS_EXPORTER</span><span class="o">=</span>prometheus
<span class="nv">OTEL_TRACES_EXPORTER</span><span class="o">=</span>otlp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="explanation-of-each-variable">Explanation of Each Variable</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>JAVA_TOOL_OPTIONS</strong>: Specifies the path to the OpenTelemetry Java agent, which automatically instruments the application to capture logs, traces, and metrics.</p>
</li>
<li>
<p><strong>OTEL_EXPORTER_OTLP_ENDPOINT</strong>: Defines the endpoint for sending telemetry data to the OpenTelemetry Collector. The default port is 4318.</p>
</li>
<li>
<p><strong>OTEL_LOGS_EXPORTER</strong>: Indicates that logs should be exported using the OpenTelemetry Protocol (OTLP).</p>
</li>
<li>
<p><strong>OTEL_METRICS_EXPORTER</strong>: Specifies that metrics should be exported and made available for scraping by <strong>Prometheus</strong>.</p>
</li>
<li>
<p><strong>OTEL_TRACES_EXPORTER</strong>: Configures trace data to be exported using the OTLP protocol.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="data-flow-for-observability-components">Data flow for Observability Components</h3>
<div class="paragraph">
<p>Once these environment variables are set, the OpenTelemetry Instrumentation captures and routes telemetry data as follows:</p>
</div>
<div class="sect3">
<h4 id="traces">Traces</h4>
<div class="ulist">
<ul>
<li>
<p>Traces are sent to the OpenTelemetry Collector, which forwards them to Jaeger for visualization.</p>
</li>
<li>
<p>The traces are also stored in Cassandra for long-term storage.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="logs">Logs</h4>
<div class="ulist">
<ul>
<li>
<p>Logs are sent to the OpenTelemetry Collector, which forwards them to:</p>
<div class="ulist">
<ul>
<li>
<p><strong>OpenSearch Data Prepper</strong>: For processing and storage in OpenSearch, enabling search and analysis of logs.</p>
</li>
<li>
<p><strong>NSA2-OTEL-Exporter</strong>: A Log-Trace correlation server. It correlates logs with traces and stores both in Cassandra, allowing developers to view logs and traces together in Jaeger for better debugging and analysis.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="metrics">Metrics</h4>
<div class="ulist">
<ul>
<li>
<p>OpenTelemetry Instrumentation provides an endpoint for Prometheus to scrape metrics data. The metrics endpoint is available at: <a href="http://your-application-pods:9464/metrics" class="bare">http://your-application-pods:9464/metrics</a>.</p>
</li>
<li>
<p>The OpenTelemetry Target Allocator helps forward the metrics to Prometheus, where they can be visualized and monitored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In summary, By setting these environment variables, you enable a comprehensive observability setup for your application, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Traces</strong>: Visualized in Jaeger and stored in Cassandra</p>
</li>
<li>
<p><strong>Logs</strong>: Searchable in OpenSearch and correlated with traces in Jaeger</p>
</li>
<li>
<p><strong>Metrics</strong>: Scraped by Prometheus and visualized on dashboards</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This setup provides developers with a complete picture of their application’s behavior, helping them monitor, troubleshoot, and optimize their code efficiently.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-sample-application">Testing the Sample Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During the deployment step of 'Service Foundry for Observability', the sample application is also deployed with Other Observability components. You can access the sample application by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl <span class="nt">-n</span> &lt;namespace&gt; port-forward svc/otel-spring-example 8080:8080 9464:9464

<span class="c">#Output</span>
Forwarding from 127.0.0.1:8080 -&gt; 8080
Forwarding from <span class="o">[</span>::1]:8080 -&gt; 8080
Forwarding from 127.0.0.1:9464 -&gt; 9464
Forwarding from <span class="o">[</span>::1]:9464 -&gt; 9464</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that port 8080 is used to access the sample application, and port 9464 is used to access the Prometheus metrics endpoint. You can access the sample application by visiting</p>
</div>
<div class="sect2">
<h3 id="call-the-sample-application">Call the sample application</h3>
<div class="paragraph">
<p>To make requests to the sample application, you can use the following curl commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>curl http://localhost:8080/otel | jq</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of the output you will see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Slept for 1 seconds"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Slept for 4 seconds"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Slept for 4 seconds"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Slept for 2 seconds"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Slept for 4 seconds"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In /otel endpoint, there were 5 calls to /sleep/{seconds} endpoint and each took 1, 4, 4, 3, and 4 seconds respectively. So we can expect the traces to show the duration of each call.</p>
</div>
</div>
<div class="sect2">
<h3 id="call-metrics-endpoint">Call metrics endpoint</h3>
<div class="paragraph">
<p>To simply view what metrics data is being provided by the OpenTelemetry Instrumentation, you can access the Prometheus metrics endpoint by visiting <a href="http://localhost:9464/metrics" class="bare">http://localhost:9464/metrics</a>.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/metrics-endpoint.png" alt="metrics endpoint">
</div>
<div class="title">Figure 1. Metrics endpoint</div>
</div>
<div class="paragraph">
<p>Later in this article, we will see how Prometheus can be used to visualize the metrics data collected by the OpenTelemetry Target Allocator.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="traces-in-jaeger">Traces in Jaeger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To view the traces captured by OpenTelemetry, you can access the Jaeger UI by visiting <a href="http://localhost:16686" class="bare">http://localhost:16686</a>. You should see traces similar to the following:</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/jaeger-ui-1.png" alt="jaeger ui 1">
</div>
<div class="title">Figure 2. Search by service name and operation name</div>
</div>
<div class="paragraph">
<p>Whenever any endpoints are called, OpenTelemetry Instrumentation captures the traces and sends them to the OpenTelemetry Collector. The OpenTelemetry Collector then forwards the traces to Jaeger.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/jaeger-ui-2.png" alt="jaeger ui 2">
</div>
<div class="title">Figure 3. Spans for a trace</div>
</div>
<div class="paragraph">
<p>We can see the spans for each call to the /sleep/{seconds} endpoint. The duration of each span corresponds to the time taken by the endpoint to respond.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/jaeger-ui-3.png" alt="jaeger ui 3">
</div>
<div class="title">Figure 4. Correlated logs and traces</div>
</div>
<div class="paragraph">
<p>In the Jaeger UI, you can see the logs and traces together in the same view. This is possible because logs are correlated with traces and stored in Cassandra with the trace data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="logs-in-opensearch">Logs in OpenSearch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Logs captured by OpenTelemetry are sent to OpenSearch Data Prepper for processing and storage in OpenSearch. You can access the logs by visiting <a href="http://localhost:5601" class="bare">http://localhost:5601</a>.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/opensearch-dashboards-login.png" alt="opensearch dashboards login">
</div>
<div class="title">Figure 5. logs in OpenSearch Dashboards</div>
</div>
<div class="paragraph">
<p>With admin credentials, you can log in to OpenSearch Dashboards</p>
</div>
<div class="paragraph">
<p>You need to create an index pattern to view the logs in OpenSearch Dashboards.</p>
</div>
<div class="paragraph">
<p>Click on the <strong>Management</strong> &gt; Index Management on the left sidebar, then click on <strong>Create index pattern</strong>.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/opensearch-dashboards-ui-1.png" alt="opensearch dashboards ui 1">
</div>
<div class="title">Figure 6. Create Index - step 1</div>
</div>
<div class="paragraph">
<p>In the <strong>Index pattern</strong> field, enter the index pattern name (e.g., <code>o11y-*</code>) and click <strong>Next step</strong>.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/opensearch-dashboards-ui-2.png" alt="opensearch dashboards ui 2">
</div>
<div class="title">Figure 7. Create Index - step 2</div>
</div>
<div class="paragraph">
<p>Select the <strong>@timestamp</strong> field as the Time Filter field and click <strong>Create index pattern</strong>.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/opensearch-dashboards-ui-3.png" alt="opensearch dashboards ui 3">
</div>
<div class="title">Figure 8. Create Index - step 3</div>
</div>
<div class="paragraph">
<p>You can now view the logs in OpenSearch Dashboards.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/opensearch-dashboards-ui-4.png" alt="opensearch dashboards ui 4">
</div>
<div class="title">Figure 9. Search logs by trace id</div>
</div>
<div class="paragraph">
<p>The screenshot above shows the logs for a specific trace ID. You can search for logs by trace ID to correlate logs with traces and gain insights into the application behavior.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics-in-prometheus">Metrics in Prometheus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Metrics collected by the OpenTelemetry Target Allocator are forwarded to Prometheus for visualization.</p>
</div>
<div class="paragraph">
<p>To access the Prometheus UI, we need to port-forward the Prometheus service to our local machine. You can do this by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl <span class="nt">-n</span> &lt;namespace&gt; port-forward svc/prometheus 9090:9090</code></pre>
</div>
</div>
<div class="paragraph">
<p>To view the metrics collected by the OpenTelemetry Target Allocator, you can access the Prometheus UI by visiting <a href="http://localhost:9090" class="bare">http://localhost:9090</a>. You should see the Prometheus UI with the metrics collected from the sample application.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/prometheus-ui.png" alt="prometheus ui">
</div>
<div class="title">Figure 10. jvm cpu usage</div>
</div>
<div class="paragraph">
<p>The screenshot above shows the CPU usage of the Java process running the sample application. You can use Prometheus to create custom dashboards and alerts based on the metrics collected by the OpenTelemetry Target Allocator.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics-in-grafana">Metrics in Grafana</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Metrics collected by Prometheus can be visualized using Grafana.</p>
</div>
<div class="paragraph">
<p>To access the Grafana UI, we need to port-forward the Grafana service to our local machine. You can do this by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl <span class="nt">-n</span> &lt;namespace&gt; port-forward svc/grafana 3000:80</code></pre>
</div>
</div>
<div class="paragraph">
<p>Navigate to <a href="http://localhost:3000" class="bare">http://localhost:3000</a> and log in with the default credentials (admin/admin). You should see the Grafana UI with the pre-configured dashboard for the sample application.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/grafana-login.png" alt="grafana login">
</div>
<div class="title">Figure 11. Grafana login</div>
</div>
<div class="paragraph">
<p>We can use the credentials admin/admin to log in to Grafana.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/grafana-connection-1.png" alt="grafana connection 1">
</div>
<div class="title">Figure 12. Grafana - Add new Connection</div>
</div>
<div class="paragraph">
<p>To add a new Prometheus data source, click on the <strong>Connections</strong> menu on the left sidebar, then click on <strong>Prometheus</strong> on the list of Data sources.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/grafana-connection-2.png" alt="grafana connection 2">
</div>
<div class="title">Figure 13. Grafana - Prometheus Connection</div>
</div>
<div class="paragraph">
<p>Put the connection name and the Prometheus URL (<a href="http://prometheus:9090" class="bare">http://prometheus:9090</a>) in the respective fields and click <strong>Save &amp; Test</strong>.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/grafana-explore.png" alt="grafana explore">
</div>
<div class="title">Figure 14. Grafana - Explore</div>
</div>
<div class="paragraph">
<p>You can now explore the metrics collected by Prometheus using Grafana. You can create custom dashboards and alerts based on the metrics data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="required-resources-to-run-an-observability-platform-on-kubernetes">Required Resources to Run an Observability Platform on Kubernetes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To set up an observability platform on a Kubernetes cluster, it’s important to understand the resource requirements for the various components. Here’s a detailed breakdown and explanation to make it easier to understand.</p>
</div>
<div class="sect2">
<h3 id="resource-utilization-example-idle-state">Resource Utilization Example (Idle State)</h3>
<div class="paragraph">
<p>The following example shows resource consumption for the observability components running in the o11y namespace during an idle state.</p>
</div>
<div class="listingblock">
<div class="title">kubectl top pods for o11y namespace (idle)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl top pods
NAME                                        CPU<span class="o">(</span>cores<span class="o">)</span>   MEMORY<span class="o">(</span>bytes<span class="o">)</span>
cassandra-0                                 551m         1536Mi
cassandra-1                                 405m         1542Mi
cassandra-2                                 531m         1523Mi
data-prepper-788b97d58d-z9wgc               47m          337Mi
grafana-85bc877866-8z776                    2m           92Mi
jaeger-collector-5d8c58f9f7-4m5dn           1m           16Mi
jaeger-query-554b877665-qr4sh               1m           22Mi
nsa2-otel-exporter-d54757c45-9snv2          2m           271Mi
o11y-otel-spring-example-6c64bb76c8-x4lp2   2m           277Mi
opensearch-cluster-master-0                 7m           995Mi
opensearch-cluster-master-1                 8m           1006Mi
opensearch-cluster-master-2                 7m           990Mi
opensearch-dashboards-7bfd998cf8-xjxrj      1m           192Mi
otel-collector-0                            1m           35Mi
otel-targetallocator-77f6b86946-wpg6b       1m           27Mi
prometheus-prometheus-0                     1m           49Mi</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="explanation-of-components">Explanation of Components</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Cassandra:</p>
<div class="ulist">
<ul>
<li>
<p>Used for long-term storage of trace and log data.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data Prepper:</p>
<div class="ulist">
<ul>
<li>
<p>Processes and formats log data for OpenSearch.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Grafana:</p>
<div class="ulist">
<ul>
<li>
<p>Used for dashboard visualization of metrics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Jaeger:</p>
<div class="ulist">
<ul>
<li>
<p>Comprises collector and query components for trace visualization.</p>
</li>
</ul>
</div>
</li>
<li>
<p>NSA2-OTEL-Exporter:</p>
<div class="ulist">
<ul>
<li>
<p>Handles log and trace correlation.</p>
</li>
</ul>
</div>
</li>
<li>
<p>OpenSearch and OpenSearch Dashboards:</p>
<div class="ulist">
<ul>
<li>
<p>Stores and visualizes log data.</p>
</li>
</ul>
</div>
</li>
<li>
<p>OpenTelemetry Components (Collector &amp; Target Allocator):</p>
<div class="ulist">
<ul>
<li>
<p>Responsible for data collection and distribution for traces, logs, and metrics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Prometheus:</p>
<div class="ulist">
<ul>
<li>
<p>Collects and stores metrics data.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="minimum-node-requirements">Minimum Node Requirements</h3>
<div class="paragraph">
<p>If you already have a Kubernetes cluster, you need at least one node with 4 CPUs and 16 GB of memory to run the observability components efficiently.</p>
</div>
</div>
<div class="sect2">
<h3 id="important-considerations">Important Considerations</h3>
<div class="ulist">
<ul>
<li>
<p>The above resource usage is based on an idle state. Actual resource consumption may increase during heavy traffic or large data processing.</p>
</li>
<li>
<p>Ensure sufficient capacity in your Kubernetes cluster to handle additional application workloads along with the observability platform.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By understanding these resource requirements, you can plan and scale your Kubernetes environment effectively to maintain a robust and efficient observability platform.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="application-observability-with-opentelemetry-for-developers">Application Observability with OpenTelemetry for Developers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During the development process, it’s crucial for developers to monitor and gain insights into how their applications behave. This helps identify and fix issues early, long before the application is deployed to production. OpenTelemetry provides a powerful set of tools to make this possible.</p>
</div>
<div class="sect2">
<h3 id="why-monitoring-matters-during-development">Why Monitoring Matters During Development</h3>
<div class="paragraph">
<p>When building and testing applications locally, developers need visibility into:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Application Behavior</strong>: How the application handles different inputs and workloads.</p>
</li>
<li>
<p><strong>Performance Bottlenecks</strong>: Areas where the application might be slowing down.</p>
</li>
<li>
<p><strong>Errors and Failures</strong>: Issues that need immediate attention to prevent larger problems in production.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="how-opentelemetry-helps">How OpenTelemetry Helps</h3>
<div class="paragraph">
<p>OpenTelemetry makes it easy for developers to capture and analyze logs and traces directly from their local machines. Here’s how it benefits developers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Log Capture</strong>: Developers can capture logs that provide detailed information about events within the application. This helps track the sequence of operations and detect any anomalies.</p>
</li>
<li>
<p><strong>Trace Collection</strong>: Traces allow developers to visualize the flow of requests and interactions across various parts of the application. This is especially helpful for identifying delays or failures in complex systems.</p>
</li>
<li>
<p><strong>Performance Insights</strong>: By analyzing logs and traces, developers can gain insights into the performance of their applications and identify areas for optimization.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="example-use-case">Example Use Case</h3>
<div class="paragraph">
<p>Imagine a developer is building an API service that handles multiple requests. During testing, they notice a delay when processing certain requests. With OpenTelemetry traces, they can pinpoint the exact part of the code causing the delay and make optimizations to improve performance.</p>
</div>
<div class="paragraph">
<p>By capturing logs and traces locally, developers gain valuable insights that speed up debugging, enhance application quality, and ensure smoother production deployments.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-to-set-up-opentelemetry-for-local-development">How to set up OpenTelemetry for local development</h3>
<div class="imageblock img-wide">
<div class="content">
<img src="images/application-observability-for-developers.png" alt="application observability for developers">
</div>
<div class="title">Figure 15. Application Observability for Developers</div>
</div>
<div class="paragraph">
<p>After setting up OpenTelemetry and other observability components in a Kubernetes environment, developers can leverage these tools to monitor and gain insights into their applications during the development process.</p>
</div>
</div>
<div class="sect2">
<h3 id="logs-and-traces">Logs and Traces</h3>
<div class="paragraph">
<p>Developers can utilize the <strong>OpenTelemetry Collector</strong> to capture logs and traces directly from their local development machines. This allows them to track application behavior, identify performance bottlenecks, and troubleshoot issues without relying solely on the production observability setup. The logs and traces collected can be seamlessly integrated with the observability infrastructure running on Kubernetes.</p>
</div>
</div>
<div class="sect2">
<h3 id="metrics-collection-limitation">Metrics Collection Limitation</h3>
<div class="paragraph">
<p>Unlike logs and traces, <strong>OpenTelemetry Target Allocator</strong>, which runs on Kubernetes, is unable to collect metrics directly from developers’ local machines. This limitation exists because the Target Allocator is designed to discover and scrape metrics from services deployed within the Kubernetes environment, not external devices.</p>
</div>
</div>
<div class="sect2">
<h3 id="benefits-for-developers">Benefits for Developers</h3>
<div class="paragraph">
<p>Despite the metric collection limitation, OpenTelemetry remains a valuable tool for developers when building, testing, and debugging applications locally. Here’s why:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Enhanced Debugging</strong>: The ability to capture logs and traces locally helps developers quickly identify and resolve issues.</p>
</li>
<li>
<p><strong>Application Insights</strong>: Developers gain visibility into how their code behaves during different test scenarios.</p>
</li>
<li>
<p><strong>Seamless Integration</strong>: Local observability testing can be aligned with the production observability setup, leading to smoother deployments.</p>
</li>
<li>
<p><strong>Performance Optimization</strong>: By analyzing logs and traces, developers can optimize application performance and enhance user experience.</p>
</li>
<li>
<p><strong>Collaboration</strong>: Developers can share logs and traces with team members to facilitate collaboration and knowledge sharing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In summary, while local metric collection isn’t fully supported by OpenTelemetry Target Allocator, the ability to capture logs and traces provides developers with essential insights, making their development and debugging process more efficient.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-environment-variables-for-opentelemetry-instrumentation-on-local-machines">Setting Environment Variables for OpenTelemetry Instrumentation on Local Machines</h3>
<div class="paragraph">
<p>To enable OpenTelemetry instrumentation when running a Spring Boot or any Java-based application locally, developers must configure specific environment variables. These variables inform the application on how to connect to the OpenTelemetry Collector and which telemetry data to capture.</p>
</div>
<div class="listingblock">
<div class="title">Required Environment Variables</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">JAVA_TOOL_OPTIONS</span><span class="o">=</span><span class="nt">-javaagent</span>:/path-to/opentelemetry-javaagent.jar
<span class="nv">OTEL_EXPORTER_OTLP_ENDPOINT</span><span class="o">=</span>http://otel-collector:4318
<span class="nv">OTEL_LOGS_EXPORTER</span><span class="o">=</span>otlp
<span class="nv">OTEL_METRICS_EXPORTER</span><span class="o">=</span>none
<span class="nv">OTEL_TRACES_EXPORTER</span><span class="o">=</span>otlp</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="breakdown-of-each-variable">Breakdown of Each Variable</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>JAVA_TOOL_OPTIONS</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>-javaagent:/path-to/opentelemetry-javaagent.jar</p>
</li>
<li>
<p>This tells the JVM to load the OpenTelemetry Java agent for automatic instrumentation of the application. Replace /path-to/opentelemetry-javaagent.jar with the actual path to the agent on your machine.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>OTEL_EXPORTER_OTLP_ENDPOINT</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://otel-collector:4318" class="bare">http://otel-collector:4318</a></p>
</li>
<li>
<p>Specifies the endpoint for sending traces and logs to the OpenTelemetry Collector.</p>
</li>
<li>
<p><strong>Note:</strong></p>
<div class="ulist">
<ul>
<li>
<p>If the OpenTelemetry Collector is running on Kubernetes, use otel-collector as the hostname.</p>
</li>
<li>
<p>If running locally, replace it with the Collector’s IP address or use localhost if you’ve port-forwarded the OpenTelemetry Collector to your local machine.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>OTEL_LOGS_EXPORTER</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>otlp</p>
</li>
<li>
<p>Specifies that logs should be exported using the OpenTelemetry Protocol (OTLP).</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>OTEL_METRICS_EXPORTER</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>none</p>
</li>
<li>
<p>Disables metrics export</p>
</li>
<li>
<p>This is necessary because the OpenTelemetry Target Allocator, which handles metrics collection in Kubernetes, does not support collecting metrics from developers’ local machines.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>OTEL_TRACES_EXPORTER</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>otlp</p>
</li>
<li>
<p>Enables the export of traces using OTLP.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>otel-collector is the hostname of the OpenTelemetry Collector running on Kubernetes. You can replace it with the IP address of the OpenTelemetry Collector if you are running it locally or localhost if you port-forwarded the OpenTelemetry Collector to your local machine.
Notice that OTEL_METRICS_EXPORTER is set to none. This is because the OpenTelemetry Target Allocator is not able to collect metrics from developers' devices. However, you can still use the OpenTelemetry Instrumentation to capture traces and logs from your application.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this article, we explored the key components of application observability and how OpenTelemetry can help you achieve comprehensive insights into your systems. We also demonstrated how to instrument a Spring Boot application with OpenTelemetry and set up a local development environment for monitoring and debugging applications.</p>
</div>
<div class="paragraph">
<p>Internal Link: /docs/service-foundry/02.application-observability/index.adoc</p>
</div>
</div>
</div>
        </div>
    </main>
</div>




<script>
    const toc = document.getElementById('toc');
    const container = document.getElementById('toc-container');
    if (toc && container) {
        container.appendChild(toc);
    }
</script>


<!--<button onclick="toggleTheme()" style="position: fixed; bottom: 1rem; right: 1rem; padding: 0.5rem 1rem; background-color: var(&#45;&#45;link); color: white; border: none; border-radius: 0.375rem; cursor: pointer;">-->
<!--    Toggle Theme-->
<!--</button>-->

<!--<script>-->
<!--    function toggleTheme() {-->
<!--        const html = document.documentElement;-->
<!--        const isDark = html.getAttribute("data-theme") === "dark";-->
<!--        html.setAttribute("data-theme", isDark ? "light" : "dark");-->
<!--        localStorage.setItem("theme", isDark ? "light" : "dark");-->
<!--    }-->

<!--    document.addEventListener("DOMContentLoaded", () => {-->
<!--        const savedTheme = localStorage.getItem("theme") || "light";-->
<!--        document.documentElement.setAttribute("data-theme", savedTheme);-->
<!--    });-->
<!--</script>-->

<!-- Footer -->
<footer class="bg-gray-900 text-white text-sm py-6 text-center">
    © 2025 Service Foundry. All rights reserved.
</footer>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Service Foundry for Backend - Building Scalable and Resilient Cloud-Native Applications</title>
    <!-- rouge source highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/service-foundry/pages/assets/css/main.css">

    <!-- Highlight.js script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</head>
<body class="">

<!-- Header -->
<header>
<!--    <div class="logo text-xl font-semibold">Service Foundry</div>-->
    <a href="/service-foundry/pages/index.html" class="text-2xl font-semibold hover:text-teal-400">
    Service Foundry
</a>
    <nav>
    
        
        <a href="/service-foundry/pages/getting-started/" class="">Getting Started</a>
    
        
        <a href="/service-foundry/pages/products/" class="">Products</a>
    
        
        <a href="/service-foundry/pages/documents/" class="active">Docs</a>
    
        
        <a href="/service-foundry/pages/github/" class="">GitHub</a>
    
        
        <a href="/service-foundry/pages/developers/" class="">Developers</a>
    
        
        <a href="/service-foundry/pages/demo/" class="">Demo</a>
    
</nav>
</header>


    <!-- Sub-navigation for Foundries -->
    <div class="subnav">

    
    <a href="/service-foundry/pages/documents/blog/" class="active">Blog</a>

    
    <a href="/service-foundry/pages/documents/infra-foundry/" class="">Infra</a>

    
    <a href="/service-foundry/pages/documents/sso-foundry/" class="">SSO</a>

    
    <a href="/service-foundry/pages/documents/o11y-foundry/" class="">Observability</a>

    
    <a href="/service-foundry/pages/documents/backend-foundry/" class="">Backend</a>

    
    <a href="/service-foundry/pages/documents/bigdata-foundry/" class="">Big Data</a>

<!--    <a href="/service-foundry/pages/documents/infra-foundry/index-backup.html" class="text-gray-300 hover:text-white">Infra</a>-->
<!--    <a href="/service-foundry/pages/documents/sso-foundry/index-backup.html" class="text-gray-300 hover:text-white">SSO</a>-->
<!--    <a href="/service-foundry/pages/documents/o11y-foundry/index-backup.html" class="text-gray-300 hover:text-white">Observability</a>-->
<!--    <a href="/service-foundry/pages/documents/backend-foundry/index-backup.html" class="text-gray-300 hover:text-white">Backend</a>-->
<!--    <a href="/service-foundry/pages/documents/bigdata-foundry/index-backup.html" class="text-gray-300 hover:text-white">Big Data</a>-->
</div>





<!-- Breadcrumb -->

    <nav class="breadcrumb-wrapper">
    <ol class="breadcrumb">
        
        <li>
            
            <a href="/service-foundry/pages/">Home</a>
            
            
            <span class="separator">/</span>
            
        </li>
        
        <li>
            
            <a href="/service-foundry/pages/documents/">Docs</a>
            
            
            <span class="separator">/</span>
            
        </li>
        
        <li>
            
            <a href="/service-foundry/pages/documents/blog/">Blog</a>
            
            
        </li>
        
    </ol>
</nav>





<!-- Main Layout -->
<div class="container">


    <nav id="toc-container" class="toc-nav"></nav>


    <main id="main-content">
        
        <div class="author-box">
            Young Gyu Kim
            &lt;<a href="mailto:credemol@gmail.com" style="color: #0d9488; text-decoration: none;">credemol@gmail.com</a>&gt;
        </div>
        

        <!-- Title -->
        
        <h1 class="page-title">
            Service Foundry for Backend - Building Scalable and Resilient Cloud-Native Applications
        </h1>
        

        <div class="asciidoc">
            <div id="toc" class="toc">
<div id="toctitle">On this page</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#core-cloud-native-principles">Core Cloud-Native Principles</a></li>
<li><a href="#observability-enablement">Observability Enablement</a></li>
</ul>
</li>
<li><a href="#runtime-environment-of-service-foundry-for-backend">Runtime Environment of Service Foundry for Backend</a></li>
<li><a href="#getting-started-with-service-foundry-for-backend">Getting Started with Service Foundry for Backend</a>
<ul class="sectlevel2">
<li><a href="#project-setup-procedure">Project Setup Procedure</a></li>
<li><a href="#project-initialization">Project Initialization</a></li>
<li><a href="#generating-the-project-structure">Generating the Project Structure</a></li>
<li><a href="#build-microservices-locally">Build Microservices locally</a></li>
<li><a href="#deploying-microservices-to-kubernetes">Deploying Microservices to Kubernetes</a></li>
</ul>
</li>
<li><a href="#load-balancing-with-kubernetes-gateway-and-httproute">Load Balancing with Kubernetes Gateway and HttpRoute</a>
<ul class="sectlevel2">
<li><a href="#routing-and-load-balancing">Routing and Load Balancing</a></li>
<li><a href="#dns-configuration-for-domain-resolution">DNS Configuration for Domain Resolution</a></li>
<li><a href="#accessing-microservices-via-domain-names">Accessing Microservices via Domain Names</a></li>
</ul>
</li>
<li><a href="#oauth-2-0-authentication-and-authorization">OAuth 2.0 Authentication and Authorization</a>
<ul class="sectlevel2">
<li><a href="#how-it-works">How it Works</a></li>
<li><a href="#example-access-flow">Example Access Flow</a></li>
<li><a href="#backend-for-frontend-bff-pattern">Backend For Frontend (BFF) Pattern</a></li>
</ul>
</li>
<li><a href="#distributed-tracing-with-jaeger">Distributed Tracing with Jaeger</a>
<ul class="sectlevel2">
<li><a href="#analyzing-traces-in-jaeger">Analyzing Traces in Jaeger</a></li>
</ul>
</li>
<li><a href="#centralized-logging-with-opensearch">Centralized Logging with OpenSearch</a>
<ul class="sectlevel2">
<li><a href="#viewing-logs-in-opensearch">Viewing Logs in OpenSearch</a></li>
</ul>
</li>
<li><a href="#dynamic-configuration-with-spring-config-watcher">Dynamic Configuration with Spring Config Watcher</a>
<ul class="sectlevel2">
<li><a href="#configuration-structure">Configuration Structure</a></li>
<li><a href="#testing-dynamic-configuration-updates">Testing Dynamic Configuration Updates</a></li>
<li><a href="#test-the-dynamic-configuration-reload">Test the Dynamic Configuration Reload</a></li>
</ul>
</li>
<li><a href="#consolidated-api-documentation-with-swagger">Consolidated API Documentation with Swagger</a>
<ul class="sectlevel2">
<li><a href="#why-consolidate-api-documentation-in-the-gateway">Why Consolidate API Documentation in the Gateway?</a></li>
<li><a href="#swagger-ui-examples">Swagger UI Examples</a></li>
</ul>
</li>
<li><a href="#scalability">Scalability</a>
<ul class="sectlevel2">
<li><a href="#scaling-microservices-in-kubernetes">Scaling Microservices in Kubernetes</a></li>
<li><a href="#auto-scaling-with-kubernetes-horizontal-pod-autoscaler-hpa">Auto-Scaling with Kubernetes Horizontal Pod Autoscaler (HPA)</a></li>
</ul>
</li>
<li><a href="#service-discovery-with-kubernetes-service">Service Discovery with Kubernetes Service</a></li>
<li><a href="#metrics-collection-with-prometheus">Metrics Collection with Prometheus</a></li>
<li><a href="#metrics-collection-with-grafana">Metrics Collection with Grafana</a></li>
<li><a href="#helm-charts-for-microservices">Helm Charts for Microservices</a></li>
<li><a href="#clean-up-kubernetes-resources">Clean up Kubernetes Resources</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="imageblock img-wide">
<div class="content">
<img src="images/considerations-for-microservice.png" alt="considerations for microservice">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Service Foundry for Backend</strong> is a comprehensive solution that provides a suite of tools and services for building and managing cloud-native applications. It is designed to help developers and architects create scalable, resilient, and secure backend services by leveraging modern technologies and industry best practices.</p>
</div>
<div class="paragraph">
<p>Microservices developed using Service Foundry for Backend are expected to adhere to key cloud-native architecture principles, including:</p>
</div>
<div class="sect2">
<h3 id="core-cloud-native-principles">Core Cloud-Native Principles</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Containerization</strong>: Each microservice is packaged as a container image, enabling independent deployment and scaling.</p>
</li>
<li>
<p><strong>Centralized Configuration</strong>: Configuration settings are managed centrally, allowing updates without requiring redeployment.</p>
</li>
<li>
<p><strong>Service Discovery</strong>: Microservices can dynamically locate and communicate with each other through service discovery mechanisms.</p>
</li>
<li>
<p><strong>Load Balancing</strong>: Traffic is intelligently distributed across multiple instances to ensure high availability and optimal performance.</p>
</li>
<li>
<p><strong>Centralized Logging</strong>: Logs from all microservices are aggregated in a central repository for efficient monitoring and troubleshooting.</p>
</li>
<li>
<p><strong>Distributed Tracing</strong>: End-to-end tracing provides visibility into requests flowing through multiple microservices, helping identify performance bottlenecks and failures.</p>
</li>
<li>
<p><strong>Metrics Collection</strong>: Key performance indicators (KPIs) are collected and monitored to assess the health and efficiency of microservices.</p>
</li>
<li>
<p><strong>Security</strong>: Robust authentication, authorization, and encryption mechanisms ensure secure communication and protect sensitive data.</p>
</li>
<li>
<p><strong>API Documentation</strong>: APIs are documented using OpenAPI specifications, making it easy for other services and developers to integrate.</p>
</li>
<li>
<p><strong>Scalability</strong>: Microservices can scale horizontally, adapting to increased traffic and workload demands without downtime.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="observability-enablement">Observability Enablement</h3>
<div class="paragraph">
<p><strong>Service Foundry for Backend</strong> seamlessly integrates with <strong>Service Foundry for Observability</strong>, providing a complete observability solution for microservices. This integration enables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Real-time monitoring</strong> of microservice performance and health</p>
</li>
<li>
<p><strong>Comprehensive logging</strong> for centralized visibility and debugging</p>
</li>
<li>
<p><strong>Distributed tracing</strong> to analyze request flows across microservices</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details on observability enablement, refer to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.linkedin.com/pulse/application-observability-opentelemetry-young-gyu-kim-xbyic/">Application Observability with OpenTelemetry</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="runtime-environment-of-service-foundry-for-backend">Runtime Environment of Service Foundry for Backend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>Service Foundry for Backend</strong> provides a fully integrated <strong>runtime environment</strong> designed to support scalable, secure, and observable microservices. This environment consists of several key components that ensure smooth operation, dynamic configuration, and seamless service discovery.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/backend-foundry-runtime.png" alt="backend foundry runtime">
</div>
<div class="title">Figure 1. Runtime Environment</div>
</div>
<div class="paragraph">
<p>The runtime environment provided by 'Service Foundry for Backend' consists of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Observability Enablement</strong>: A comprehensive suite of tools for <strong>monitoring, logging, and distributed tracing</strong>, ensuring the health, performance, and reliability of microservices.</p>
</li>
<li>
<p><strong>Security Server</strong>: A <strong>centralized authentication and authorization</strong> service that manages user identities, access control policies, and security tokens, ensuring secure communication between microservices.</p>
</li>
<li>
<p><strong>API Gateway</strong>: A <strong>single entry point</strong> for all incoming requests, responsible for <strong>routing, load balancing, authentication, and authorization</strong> across microservices.</p>
</li>
<li>
<p><strong>Spring Config Watcher</strong>: A <strong>configuration management service</strong> that continuously monitors changes in centralized configurations and dynamically updates microservices without requiring redeployment.</p>
</li>
<li>
<p><strong>Service Discovery</strong>: A <strong>service registry</strong> that enables microservices to <strong>dynamically locate and communicate</strong> with each other, ensuring seamless interaction and scalability.</p>
</li>
<li>
<p><strong>Kubernetes Gateway and HttpRoute</strong>: A <strong>high-performance load balancer</strong> that efficiently distributes incoming HTTP requests across multiple microservice instances to ensure <strong>high availability and fault tolerance</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This runtime environment provides a fully automated and scalable foundation for deploying and managing cloud-native microservices. Would you like to include a diagram or additional details on any specific component?</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-with-service-foundry-for-backend">Getting Started with Service Foundry for Backend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, we will create a new <strong>Spring Boot</strong> project using the <strong>Service Foundry for Backend</strong> template. This template provides a well-structured project setup with all the necessary components and configurations required to build microservices following <strong>cloud-native architecture principles</strong>.</p>
</div>
<div class="paragraph">
<p>As part of the initialization process, the following three projects will be generated:
 * {domain-name}-auth-server – A centralized <strong>authentication and authorization</strong> server managing user identities, access control policies, and security tokens for microservices.
 * {domain-name}-gateway – A centralized <strong>API gateway</strong> responsible for routing, load balancing, authentication, and authorization across microservices.
 * {domain-name}-resource-server-example – A sample microservice exposing REST APIs to manage resources.</p>
</div>
<div class="sect2">
<h3 id="project-setup-procedure">Project Setup Procedure</h3>
<div class="paragraph">
<p>Following the same steps as we did for Observability Enablement, we will now set up a new Spring Boot project using the Service Foundry for Backend template.</p>
</div>
<div class="sect3">
<h4 id="steps-to-create-and-deploy-microservices">Steps to Create and Deploy Microservices</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a directory (used as the project domain) for Spring Boot projects.</p>
</li>
<li>
<p>Initialize the project using the <strong>Service Foundry for Backend</strong> template.</p>
</li>
<li>
<p>Generate the project structure with pre-configured components.</p>
</li>
<li>
<p>Build the microservices locally.</p>
</li>
<li>
<p>Deploy the microservices to Kubernetes.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="project-initialization">Project Initialization</h3>
<div class="paragraph">
<p>We use Yeoman as the scaffolding tool to generate the project structure. Yeoman takes user inputs and creates the required components based on predefined templates.</p>
</div>
<div class="listingblock">
<div class="title">Step 1: Create the Project Directory</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span><span class="nb">mkdir </span>raincity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Step 2: Initialize the Project Using the Template</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>yo nsa2:backend-foundry init</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">User inputs during initialization</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">? Project Domain:  raincity
? Base Domain:  nsalexamy.com  &lt;<span class="nt">--</span> your domain name
? Maven Group ID:  com.company.raincity
? Base Java Package:  com.company.raincity
? Azure Container Registry Name:  my-acr &lt;- your ACR name <span class="k">for </span>storing Docker images</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command generates the nsa2-backend-foundry-build-config.yaml file, which stores the configuration settings provided during initialization.</p>
</div>
<div class="paragraph">
<p>For example, if you specify the values above, the following <strong>Kubernetes Gateway routes</strong> will be created:
 * raincity-auth-server.nsalexamy.com
 * raincity-gateway.nsalexamy.com</p>
</div>
<div class="paragraph">
<p>These routes allow access to the microservices using their respective domain names.</p>
</div>
<div class="sect3">
<h4 id="configuration-files">Configuration Files</h4>
<div class="paragraph">
<p>The initialization process also generates:
* configmap.properties – Stores non-sensitive configuration settings.
* secret.properties – Stores sensitive credentials and secrets.</p>
</div>
<div class="paragraph">
<p>Both files are mounted as <strong>ConfigMaps</strong> and <strong>Secrets</strong> in the Kubernetes cluster and used to create:
* raincity-configmap – Shared across all microservices for dynamic configuration.
* raincity-secret – Stores sensitive data securely.</p>
</div>
<div class="paragraph">
<p>These configurations will be discussed further in the section on **Dynamic Configuration using Spring.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generating-the-project-structure">Generating the Project Structure</h3>
<div class="paragraph">
<p>After reviewing the configurations, we generate the complete project structure using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>yo nsa2:backend-foundry generate</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the generated files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># to see what is generated</span>
<span class="nv">$ </span>tree <span class="nt">-L</span> 1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Generated Project Structure</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nb">.</span>
├── build-backend-foundry.sh
├── configmap.properties
├── deploy-backend-foundry.sh
├── helm-charts
├── install-postgresql.sh
├── k8s
├── nsa2-backend-foundry-build-config.yaml
├── raincity-auth-server
├── raincity-gateway
├── raincity-resource-server-example
├── secret.properties
├── undeploy-backend-foundry.sh
└── uninstall-postgresql.sh</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="key-components">Key Components</h4>
<div class="ulist">
<ul>
<li>
<p>build-backend-foundry.sh – Script to build microservices and Docker images.</p>
</li>
<li>
<p>deploy-backend-foundry.sh – Script to deploy microservices to <strong>Kubernetes</strong>.</p>
</li>
<li>
<p>undeploy-backend-foundry.sh – Script to remove deployed microservices from Kubernetes.</p>
</li>
<li>
<p>uninstall-postgresql.sh – Script to uninstall PostgreSQL and clean up <strong>Persistent Volumes</strong> (PVC/PV).</p>
</li>
<li>
<p>raincity-auth-server/ – Spring Boot project for the centralized authentication server.</p>
</li>
<li>
<p>raincity-gateway/ – Spring Boot project for the configuration and API gateway.</p>
</li>
<li>
<p>raincity-resource-server-example/ – Sample Spring Boot microservice.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build-microservices-locally">Build Microservices locally</h3>
<div class="paragraph">
<p>To build the microservices and generate the necessary Kubernetes Helm charts, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>./build-backend-foundry.sh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploying-microservices-to-kubernetes">Deploying Microservices to Kubernetes</h3>
<div class="paragraph">
<p>I deploy the microservices to Kubernetes using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>./deploy-backend-foundry.sh</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="deployment-process">Deployment process</h4>
<div class="paragraph">
<p>Deployment Process
 * The script builds Docker images and pushes them to the Azure Container Registry (ACR).
 * It then deploys the microservices to the Kubernetes cluster using Helm charts.
 * The deployment process may take a few minutes until all resources are up and running.
 * All Kubernetes resources will be created under the raincity namespace.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="load-balancing-with-kubernetes-gateway-and-httproute">Load Balancing with Kubernetes Gateway and HttpRoute</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kubernetes Gateway, combined with HttpRoute, provides seamless load balancing and routing for microservices. During deployment, all microservices are automatically registered with the Kubernetes Gateway using HttpRoute resources, ensuring efficient traffic distribution and high availability.</p>
</div>
<div class="paragraph">
<p>For more details, refer to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.linkedin.com/pulse/kubernetes-gateway-api-aks-young-gyu-kim-vdhyc/">Kubernetes Gateway API on AKS</a></p>
</li>
</ul>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/load-balancing.png" alt="load balancing">
</div>
<div class="title">Figure 2. Load Balancing</div>
</div>
<div class="sect2">
<h3 id="routing-and-load-balancing">Routing and Load Balancing</h3>
<div class="paragraph">
<p>During deployment, the HttpRoute resource defines routing rules for handling incoming HTTP requests. You can list the registered routes using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl <span class="nt">-n</span> raincity get httproutes</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Output</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># output</span>
NAME                                     HOSTNAMES                                            AGE
raincity-auth-server-route               <span class="o">[</span><span class="s2">"raincity-auth-server.nsalexamy.com"</span><span class="o">]</span>               12h
raincity-gateway-route                   <span class="o">[</span><span class="s2">"raincity-gateway.nsalexamy.com"</span><span class="o">]</span>                   12h
raincity-resource-server-example-route   <span class="o">[</span><span class="s2">"raincity-resource-server-example.nsalexamy.com"</span><span class="o">]</span>   12h</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dns-configuration-for-domain-resolution">DNS Configuration for Domain Resolution</h3>
<div class="paragraph">
<p>To enable domain name resolution, add the following entries to your <strong>DNS server</strong> or <strong>/etc/hosts</strong> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">your-k8s-gateway-ip 		raincity-gateway.nsalexamy.com
your-k8s-gateway-ip 		raincity-auth-server.nsalexamy.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can retrieve the Kubernetes Gateway IP address using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>fqdn<span class="si">$(</span>kubectl get gateway your-k8s-ateway <span class="nt">-n</span> your-gateway-namespace <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.status.addresses[0].value}'</span><span class="si">)</span>

<span class="nv">$ </span>dig <span class="nv">$fqdn</span> +short</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>nslookup <span class="nv">$fqdn</span> | <span class="nb">grep </span>Address | <span class="nb">tail</span> <span class="nt">-n</span> 1 | <span class="nb">awk</span> <span class="s1">'{print $2}'</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="accessing-microservices-via-domain-names">Accessing Microservices via Domain Names</h3>
<div class="paragraph">
<p>Once DNS resolution is configured, you can access microservices using their <strong>domain names</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>curl http://raincity-gateway.nsalexamy.com/actuator/health | jq</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example Response</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># output</span>
<span class="o">{</span>
  <span class="s2">"status"</span>: <span class="s2">"UP"</span>,
  <span class="s2">"groups"</span>: <span class="o">[</span>
    <span class="s2">"liveness"</span>,
    <span class="s2">"readiness"</span>
  <span class="o">]</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With Kubernetes Gateway and HttpRoute, microservices are efficiently load-balanced, ensuring scalability, high availability, and seamless traffic routing</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="oauth-2-0-authentication-and-authorization">OAuth 2.0 Authentication and Authorization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authentication and authorization in Service Foundry for Backend are managed by a centralized authentication and authorization server, raincity-auth-server. This server is responsible for issuing OAuth 2.0 security tokens to authenticate and authorize requests from both microservices and clients.</p>
</div>
<div class="sect2">
<h3 id="how-it-works">How it Works</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To access a microservice, clients must first obtain an access token from the raincity-auth-server.</p>
</li>
<li>
<p>The access token is then included in the HTTP request headers to authenticate and authorize the request.</p>
</li>
<li>
<p>If a client attempts to access a protected microservice (e.g., raincity-resource-server-example) without a valid token, they are automatically redirected to the authentication server to log in.</p>
</li>
<li>
<p>Once authenticated, an access token is issued, and the client can use it to access microservices securely.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="example-access-flow">Example Access Flow</h3>
<div class="paragraph">
<p>Test URL(Accessing a Protected Resource)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://raincity-gateway.nsalexamy.com/resource-server/hello</pre>
</div>
</div>
<div class="paragraph">
<p>Redirected Login Page</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://raincity-auth-server.nsalexamy.com/login</pre>
</div>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/security-login.png" alt="security login">
</div>
<div class="title">Figure 3. Redirected URL</div>
</div>
<div class="sect3">
<h4 id="test-credentials">Test Credentials</h4>
<div class="paragraph">
<p>Use the following credentials to authenticate and obtain an access token:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Username</strong>: raincityadmin</p>
</li>
<li>
<p><strong>Password</strong>: password</p>
</li>
</ul>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/resource-server-example-1.png" alt="resource server example 1">
</div>
<div class="title">Figure 4. Resource Server Example</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="backend-for-frontend-bff-pattern">Backend For Frontend (BFF) Pattern</h3>
<div class="paragraph">
<p>The <strong>Backend For Frontend (BFF) pattern</strong> is used in the microservices architecture to improve security and streamline authentication.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unlike traditional approaches, the <strong>JWT token is not visible</strong> in browser developer tools (e.g., Chrome DevTools).</p>
</li>
<li>
<p>Instead, the token is securely stored in the <strong>session store of the raincity-gateway microservice</strong>, ensuring better security and session management.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By leveraging <strong>OAuth 2.0 with the BFF pattern</strong>, the <strong>Service Foundry for Backend</strong> ensures secure, scalable, and seamless authentication across microservices</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="distributed-tracing-with-jaeger">Distributed Tracing with Jaeger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All microservices in <strong>Service Foundry for Backend</strong> are instrumented with <strong>Jaeger</strong> for <strong>distributed tracing</strong>. Jaeger, an open-source tracing system, helps monitor, troubleshoot, and analyze the performance of microservices-based applications.</p>
</div>
<div class="paragraph">
<p>Since we have already invoked the microservices in the previous section, their traces can be viewed in the <strong>Jaeger UI</strong>.</p>
</div>
<div class="sect2">
<h3 id="analyzing-traces-in-jaeger">Analyzing Traces in Jaeger</h3>
<div class="ulist">
<ul>
<li>
<p>Use raincity-gateway as the service name to search for traces.</p>
</li>
<li>
<p>View detailed information, including spans, logs, and tags, to analyze request flows and identify bottlenecks.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="example-searching-for-traces">Example: Searching for Traces</h4>
<div class="imageblock img-wide">
<div class="content">
<img src="images/jaeger-1.png" alt="jaeger 1">
</div>
<div class="title">Figure 5. Searching Traces in Jaeger</div>
</div>
</div>
<div class="sect3">
<h4 id="example-viewing-request-flows">Example: Viewing Request Flows</h4>
<div class="paragraph">
<p>Clicking on a trace reveals in-depth details about the request lifecycle, including spans, logs, and execution timelines.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/jaeger-2.png" alt="jaeger 2">
</div>
<div class="title">Figure 6. Viewing Traces, Spans, and Logs</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="centralized-logging-with-opensearch">Centralized Logging with OpenSearch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For centralized log management, all microservices are integrated with <strong>OpenSearch</strong>, an open-source <strong>search and analytics engine</strong> designed for collecting, storing, and analyzing logs at scale.</p>
</div>
<div class="sect2">
<h3 id="viewing-logs-in-opensearch">Viewing Logs in OpenSearch</h3>
<div class="paragraph">
<p>To inspect logs for the <strong>raincity-gateway</strong> microservice, enter the following query in the <strong>DQL search bar</strong> within the <strong>OpenSearch Dashboard</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>serviceName:raincity-gateway</pre>
</div>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/opensearch-dashboards.png" alt="opensearch dashboards">
</div>
<div class="title">Figure 7. Logs Dashboard in OpenSearch</div>
</div>
<div class="paragraph">
<p>With Jaeger for tracing and OpenSearch for centralized logging, the Service Foundry for Backend provides deep observability, enabling efficient monitoring, troubleshooting, and performance optimization for cloud-native applications.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dynamic-configuration-with-spring-config-watcher">Dynamic Configuration with Spring Config Watcher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Config Watcher enables <strong>dynamic configuration updates</strong> for microservices without requiring a restart. It continuously monitors changes in <strong>Kubernetes ConfigMaps and Secrets</strong> and automatically reloads updated configurations in the microservices.</p>
</div>
<div class="paragraph">
<p>For detailed information, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.linkedin.com/pulse/auto-reload-config-properties-spring-cloud-k8s-watcher-kim-i4nmc/">Auto Reload Config Properties in Spring Cloud using Kubernetes ConfigMap Watcher</a></p>
</li>
<li>
<p><a href="https://www.linkedin.com/pulse/spring-cloud-gateway-configwatcher-young-gyu-kim-x4qqc/">Spring Cloud Gateway ConfigWatcher</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="configuration-structure">Configuration Structure</h3>
<div class="paragraph">
<p>Each microservice has its own ConfigMap and Secret, in addition to shared configurations:</p>
</div>
<div class="paragraph">
<p><strong>Shared Across All Microservices</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ConfigMap</strong>: raincity-configmap</p>
</li>
<li>
<p><strong>Secret</strong>: raincity-secret</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Specific to Each Microservice (Example: raincity-gateway)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ConfigMap</strong>: raincity-gateway</p>
</li>
<li>
<p><strong>Secret</strong>: raincity-gateway</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Mounted Configuration Directories</strong></p>
</div>
<div class="paragraph">
<p>Configuration settings are mounted as files in microservices under the following directories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/etc/configs/common/ - common ConfigMap</p>
</li>
<li>
<p>/etc/secrets/common/ - common Secret</p>
</li>
<li>
<p>/etc/configs/app/ - microservice-specific ConfigMap</p>
</li>
<li>
<p>/etc/secrets/app/ - microservice-specific Secret</p>
</li>
</ul>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/config-watcher.png" alt="config watcher">
</div>
<div class="title">Figure 8. Spring Config Watcher</div>
</div>
<div class="paragraph">
<p>Each microservice loads configuration settings from ConfigMaps and Secrets via bootstrap.yaml:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yaml of raincity-gateway</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># omitted for brevity</span>

<span class="nn">---</span>
<span class="na">spring.config.activate.on-profile</span><span class="pi">:</span> <span class="s">kubernetes</span>

<span class="na">spring</span><span class="pi">:</span>
  <span class="na">config</span><span class="pi">:</span>
    <span class="na">import</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">configtree:/etc/configs/app/</span>
      <span class="pi">-</span> <span class="s">configtree:/etc/configs/common/</span>
      <span class="pi">-</span> <span class="s">configtree:/etc/secrets/app/</span>
      <span class="pi">-</span> <span class="s">configtree:/etc/secrets/common/</span>

<span class="na">spring.cloud.kubernetes</span><span class="pi">:</span>

  <span class="na">reload</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">monitoring-config-maps</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">monitoring-secrets</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">mode</span><span class="pi">:</span> <span class="s">event</span>

  <span class="na">config</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">raincity</span>
    <span class="na">sources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">raincity-configmap</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">raincity-gateway</span>

  <span class="na">secrets</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">raincity</span>
    <span class="na">sources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">raincity-secret</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">raincity-gateway</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration enables automatic reload of ConfigMap and Secret changes in the raincity namespace.</p>
</div>
</div>
<div class="sect2">
<h3 id="testing-dynamic-configuration-updates">Testing Dynamic Configuration Updates</h3>
<div class="sect3">
<h4 id="configwatchercontroller">ConfigWatcherController</h4>
<div class="paragraph">
<p>A REST controller (ConfigWatcherController) is provided to test <strong>dynamic configuration reloading</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">@RefreshScope  // Enables dynamic configuration reload
@RestController
@RequestMapping<span class="o">(</span><span class="s2">"/config-watcher"</span><span class="o">)</span>
@Slf4j
public class ConfigWatcherController <span class="o">{</span>
    @Value<span class="o">(</span><span class="s2">"</span><span class="k">${</span><span class="nv">COMMON_PROPERTY</span>:unknown<span class="k">}</span><span class="s2">"</span><span class="o">)</span>
    private String commonProperty<span class="p">;</span>

    @Value<span class="o">(</span><span class="s2">"</span><span class="k">${</span><span class="nv">APP_PROPERTY</span>:unknown<span class="k">}</span><span class="s2">"</span><span class="o">)</span>
    private String appProperty<span class="p">;</span>

    private final Environment <span class="nb">env</span><span class="p">;</span>

    public ConfigWatcherController<span class="o">(</span>Environment <span class="nb">env</span><span class="o">)</span> <span class="o">{</span>
        this.env <span class="o">=</span> <span class="nb">env</span><span class="p">;</span>
    <span class="o">}</span>

    @GetMapping<span class="o">(</span><span class="s2">"/"</span><span class="o">)</span>
    public Map&lt;String, String&gt; getConfig<span class="o">()</span> <span class="o">{</span>
        var config <span class="o">=</span> Map.of<span class="o">(</span><span class="s2">"commonProperty"</span>, commonProperty,
                <span class="s2">"appProperty"</span>, appProperty
        <span class="o">)</span><span class="p">;</span>

        log.info<span class="o">(</span><span class="s2">"config: {}"</span>, config<span class="o">)</span><span class="p">;</span>
        <span class="k">return </span>config<span class="p">;</span>
    <span class="o">}</span>

    @GetMapping<span class="o">(</span><span class="s2">"/{name}"</span><span class="o">)</span>
    public String getProperty<span class="o">(</span>@PathVariable String name<span class="o">)</span> <span class="o">{</span>
        var value <span class="o">=</span> env.getProperty<span class="o">(</span>name, <span class="s2">"unknown"</span><span class="o">)</span><span class="p">;</span>

        log.info<span class="o">(</span><span class="s2">"property - name: {}, value: {}"</span>, name, value<span class="o">)</span><span class="p">;</span>
        <span class="k">return </span>value<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The @RefreshScope annotation ensures that the microservice automatically reloads configurations when they change.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="test-the-dynamic-configuration-reload">Test the Dynamic Configuration Reload</h3>
<div class="paragraph">
<p>In the raincity-configmap ConfigMap, there is a property named 'COMMON_PROPERTY' with the value 'raincity'. And each microservice&#8217;s ConfigMap, there is a property named 'APP_PROPERTY' with the value 'raincity-gateway'.</p>
</div>
<div class="paragraph">
<p>I used a web browser to access the ConfigWatcherController endpoint, because it is easy to handle JWT tokens in the browser.</p>
</div>
<div class="paragraph">
<p>Test URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://raincity-gateway.nsalexamy.com/config-watcher/COMMON_PROPERTY</pre>
</div>
</div>
<div class="paragraph">
<p>Before updating, fetch the COMMON_PROPERTY value from raincity-configmap:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl <span class="nt">-n</span> raincity get configmap raincity-configmap <span class="nt">-o</span> yaml | yq .data.COMMON_PROPERTY

raincity</code></pre>
</div>
</div>
<div class="paragraph">
<p>If calling the ConfigWatcherController endpoint, the response will be 'raincity'.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/config-watcher-test-1.png" alt="config watcher test 1">
</div>
<div class="title">Figure 9. COMMON_PROPERTY before updating</div>
</div>
<div class="paragraph">
<p>I updated the COMMON_PROPERTY value in the raincity-configmap to 'raincity-updated'.</p>
</div>
<div class="listingblock">
<div class="title">Retrieve the updated value:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl <span class="nt">-n</span> raincity get configmap raincity-configmap <span class="nt">-o</span> yaml | yq .data.COMMON_PROPERTY

raincity-updated</code></pre>
</div>
</div>
<div class="paragraph">
<p>If calling the ConfigWatcherController endpoint again, now the response will be 'raincity-updated'.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/config-watcher-test-2.png" alt="config watcher test 2">
</div>
<div class="title">Figure 10. Updated COMMON_PROPERTY</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="consolidated-api-documentation-with-swagger">Consolidated API Documentation with Swagger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Gateway provides <strong>centralized API documentation</strong> using <strong>Swagger</strong>, an open-source tool for generating interactive documentation for RESTful APIs. By aggregating API specifications from multiple microservices, the Gateway allows developers to explore and test endpoints from a single interface.</p>
</div>
<div class="listingblock">
<div class="title">springdoc in application.yaml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">springdoc</span><span class="pi">:</span>

  <span class="na">swagger-ui</span><span class="pi">:</span>
    <span class="c1"># omitted for brevity</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/swagger-ui.html</span>
    <span class="na">config-url</span><span class="pi">:</span> <span class="s">/v3/api-docs/swagger-config</span>
    <span class="na">urls</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">gateway-service</span>
        <span class="na">url</span><span class="pi">:</span> <span class="s">/v3/api-docs</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">resource-server</span>
        <span class="na">url</span><span class="pi">:</span> <span class="s">/resource-server/v3/api-docs</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Key Configuration Points:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>enabled: true → Activates Swagger UI</p>
</li>
<li>
<p>path: /swagger-ui.html → Defines the Swagger UI endpoint</p>
</li>
<li>
<p>urls → Lists API documentation for multiple microservices</p>
<div class="ulist">
<ul>
<li>
<p>/v3/api-docs → Gateway API documentation</p>
</li>
<li>
<p>/resource-server/v3/api-docs → Resource Server API documentation</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>With this setup, <strong>each microservice’s API documentation is accessible through the Gateway</strong>, making it easier to explore and test APIs in a centralized way.</p>
</div>
<div class="sect2">
<h3 id="why-consolidate-api-documentation-in-the-gateway">Why Consolidate API Documentation in the Gateway?</h3>
<div class="ulist">
<ul>
<li>
<p>Unified Access → Since resource servers are typically not directly accessible, hosting their API documentation in the Gateway provides a single entry point.</p>
</li>
<li>
<p>Improved Security → Ensures API documentation follows the same security policies as API access through the Gateway.</p>
</li>
<li>
<p>Simplified Development &amp; Testing → Developers can explore APIs from multiple microservices in one place.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="swagger-ui-examples">Swagger UI Examples</h3>
<div class="paragraph">
<p>Gateway API Documentation</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/swagger-gateway-service.png" alt="swagger gateway service">
</div>
<div class="title">Figure 11. Swagger UI - Gateway</div>
</div>
<div class="paragraph">
<p>Resource Server API Documentation</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/swagger-resource-server.png" alt="swagger resource server">
</div>
<div class="title">Figure 12. Swagger UI - Resource Server</div>
</div>
<div class="paragraph">
<p>This consolidated approach enhances API discoverability, usability, and security, making it an essential feature for microservice-based architectures.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scalability">Scalability</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="scaling-microservices-in-kubernetes">Scaling Microservices in Kubernetes</h3>
<div class="paragraph">
<p>Microservices can be scaled dynamically using <strong>Kubernetes’ built-in scaling mechanisms</strong>, either through kubectl commands or the Kubernetes Dashboard. This ensures high availability and efficient resource utilization.</p>
</div>
<div class="sect3">
<h4 id="manual-scaling-with-kubectl">Manual Scaling with kubectl</h4>
<div class="paragraph">
<p>To scale the Resource Server Example to three replicas, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl <span class="nt">-n</span> raincity scale deployment raincity-resource-server-example <span class="nt">--replicas</span><span class="o">=</span>3</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="verifying-the-number-of-replicas">Verifying the Number of Replicas</h4>
<div class="paragraph">
<p>To confirm that the deployment has been scaled, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">kubectl <span class="nt">-n</span> raincity get pods <span class="nt">-l</span> app.kubernetes.io/name<span class="o">=</span>raincity-resource-server-example
NAME                                                READY   STATUS    RESTARTS   AGE
raincity-resource-server-example-75596f4d6b-jv6qr   1/1     Running   0          1m
raincity-resource-server-example-75596f4d6b-sxv9p   1/1     Running   0          15h
raincity-resource-server-example-75596f4d6b-z6m6x   1/1     Running   0          1m</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="auto-scaling-with-kubernetes-horizontal-pod-autoscaler-hpa">Auto-Scaling with Kubernetes Horizontal Pod Autoscaler (HPA)</h3>
<div class="paragraph">
<p>For automated scaling, Kubernetes provides the Horizontal Pod Autoscaler (HPA), which dynamically adjusts the number of replicas based on CPU utilization. HPA helps optimize resource usage and ensures microservices scale automatically under varying workloads.</p>
</div>
<div class="paragraph">
<p><strong>We will cover HPA in detail in a separate article.</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="service-discovery-with-kubernetes-service">Service Discovery with Kubernetes Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <strong>Service Foundry for Backend, Kubernetes Services</strong> enable <strong>service discovery</strong>, providing stable network endpoints for microservices to communicate seamlessly. Instead of relying on dynamic pod IPs, microservices can interact using <strong>host-based service names</strong>, ensuring reliable connectivity regardless of scaling.</p>
</div>
<div class="paragraph">
<p>Within the Kubernetes cluster, microservices communicate using their <strong>service names</strong>. For example, the raincity-gateway microservice can interact with raincity-resource-server-example simply by referencing its service name, raincity-resource-server-example, irrespective of the number of running replicas.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics-collection-with-prometheus">Metrics Collection with Prometheus</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Prometheus</strong> is an open-source monitoring and alerting toolkit designed to collect, store, and query metrics from microservices. It offers a powerful query language that allows you to analyze and visualize these metrics effectively.</p>
</div>
<div class="paragraph">
<p>For example, to retrieve the recent CPU utilization ratio of the raincity-resource-server-example microservice, you can use the following query:</p>
</div>
<div class="listingblock">
<div class="title">Example Query</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="text">jvm_cpu_recent_utilization_ratio{job='raincity-resource-server-example'}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can execute this query within the Prometheus UI to visualize and analyze the collected data.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/prometheus.png" alt="prometheus">
</div>
<div class="title">Figure 13. Prometheus UI</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics-collection-with-grafana">Metrics Collection with Grafana</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Grafana</strong> is an open-source platform for analytics and monitoring, designed to visualize and analyze metrics from microservices. It offers a wide range of visualization options for creating dashboards and setting up alerts.</p>
</div>
<div class="paragraph">
<p>Similar to Prometheus, Grafana allows us to collect and display metrics. You can create custom dashboards to visualize key metrics and set up alerts to notify you of any issues or anomalies.</p>
</div>
<div class="imageblock img-wide">
<div class="content">
<img src="images/grafana.png" alt="grafana">
</div>
<div class="title">Figure 14. Grafana Dashboard</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="helm-charts-for-microservices">Helm Charts for Microservices</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Helm charts</strong> are used to package, version, and deploy microservices on Kubernetes. Helm, a package manager for Kubernetes, streamlines the management of applications running within a Kubernetes cluster. All microservices created with <strong>‘Service Foundry for Backend’</strong> are packaged as Helm charts, enabling smooth and efficient deployment.</p>
</div>
<div class="paragraph">
<p>To list the Helm charts installed in the ‘raincity’ namespace, use the following command:</p>
</div>
<div class="listingblock">
<div class="title">Helm Chart list installed in the 'raincity' namespace</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>helm <span class="nt">-n</span> raincity list <span class="nt">--short</span>
raincity-auth-server
raincity-gateway
raincity-resource-server-example</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each Helm chart contains all the necessary Kubernetes resources for deploying the microservices. The charts manage the entire deployment lifecycle, simplifying the process of getting microservices up and running on Kubernetes.</p>
</div>
<div class="paragraph">
<p>Here’s an example of the Helm chart structure for the <strong>‘raincity-gateway’</strong> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>tree raincity-gateway/src/main/k8s
raincity-gateway/src/main/k8s
├── Dockerfile
└── helm-chart
    └── raincity-gateway
        ├── Chart.yaml
        ├── templates
        │   ├── NOTES.txt
        │   ├── _helpers.tpl
        │   ├── config-watcher-configmap-kubernetes.yaml
        │   ├── config-watcher-configmap.yaml
        │   ├── config-watcher-secret-kubernetes.yaml
        │   ├── config-watcher-secret.yaml
        │   ├── deployment.yaml
        │   ├── hpa.yaml
        │   ├── httproute.yaml
        │   ├── ingress.yaml
        │   ├── role.yaml
        │   ├── rolebinding.yaml
        │   ├── service.yaml
        │   ├── serviceaccount.yaml
        │   ├── servicemonitor.yaml
        │   └── tests
        │       └── test-connection.yaml
        └── values.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>This structure defines the various resources for deploying and managing the raincity-gateway service in a Kubernetes environment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="clean-up-kubernetes-resources">Clean up Kubernetes Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To remove all deployed microservices and associated resources from the Kubernetes cluster, execute the following script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>./undeploy-backend-foundry.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script uninstalls all Helm releases and deletes ConfigMaps, Secrets, and other related resources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>configmap "raincity-configmap" deleted
configmap "raincity-configmap-kubernetes" deleted
secret "raincity-secret" deleted
secret "raincity-secret-kubernetes" deleted
configmap "raincity-observability-configmap" deleted
Uninstalling Spring K8s Config Watcher
service "spring-cloud-kubernetes-configuration-watcher" deleted
serviceaccount "spring-cloud-kubernetes-configuration-watcher" deleted
rolebinding.rbac.authorization.k8s.io "spring-cloud-kubernetes-configuration-watcher:view" deleted
role.rbac.authorization.k8s.io "namespace-reader" deleted
deployment.apps "spring-cloud-kubernetes-configuration-watcher-deployment" deleted
Uninstalling previous auth-server
release "raincity-auth-server" uninstalled
Uninstalling previous gateway
release "raincity-gateway" uninstalled
Uninstalling previous raincity-resource-server-example
release "raincity-resource-server-example" uninstalled</pre>
</div>
</div>
<div class="paragraph">
<p>The script removes all microservices and their dependencies; however, it does not delete Persistent Volume Claims (PVCs) and Persistent Volumes (PVs) used by PostgreSQL. To remove PostgreSQL resources, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>uninstall-postgresql.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, the raincity namespace must be deleted manually. Before proceeding, ensure that you have reviewed and backed up any necessary data. To delete the namespace, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>kubectl delete namespace raincity</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In conclusion, <strong>Service Foundry for Backend</strong> is a comprehensive, cloud-native solution designed to streamline the development, deployment, and management of microservices. By leveraging Kubernetes and a set of powerful tools, <strong>Service Foundry</strong> enables organizations to build scalable, resilient, and highly observable applications. Through integrations with essential technologies such as <strong>OpenTelemetry, Jaeger, Prometheus, Grafana,</strong> and <strong>Spring Config Watcher</strong>, Service Foundry offers a robust infrastructure for real-time monitoring, centralized logging, and dynamic configuration management.</p>
</div>
<div class="paragraph">
<p>With the flexibility of Helm charts and Kubernetes’ native scaling features, developers can ensure the seamless operation of microservices in production environments, while the centralized <strong>OAuth 2.0</strong> authentication and <strong>API Gateway</strong> provide enhanced security and streamlined API management. By adopting <strong>Service Foundry for Backend</strong>, organizations can accelerate development cycles, improve operational efficiency, and provide a consistent and reliable experience for users.</p>
</div>
<div class="paragraph">
<p>In an ever-evolving technological landscape, Service Foundry for Backend represents a solid foundation for teams looking to implement cloud-native applications that are scalable, secure, and efficient.</p>
</div>
<div class="paragraph">
<p>All my LinkedIn articles are available at <a href="https://www.linkedin.com/pulse/my-linkedin-article-library-young-gyu-kim-2jihc/">My LinkedIn Article Library</a>.</p>
</div>
<div class="paragraph">
<p>Internal links: docs/service-foundry/03.backend-foundry/index.adoc</p>
</div>
</div>
</div>
        </div>
    </main>
</div>




<script>
    const toc = document.getElementById('toc');
    const container = document.getElementById('toc-container');
    if (toc && container) {
        container.appendChild(toc);
    }
</script>


<!--<button onclick="toggleTheme()" style="position: fixed; bottom: 1rem; right: 1rem; padding: 0.5rem 1rem; background-color: var(&#45;&#45;link); color: white; border: none; border-radius: 0.375rem; cursor: pointer;">-->
<!--    Toggle Theme-->
<!--</button>-->

<!--<script>-->
<!--    function toggleTheme() {-->
<!--        const html = document.documentElement;-->
<!--        const isDark = html.getAttribute("data-theme") === "dark";-->
<!--        html.setAttribute("data-theme", isDark ? "light" : "dark");-->
<!--        localStorage.setItem("theme", isDark ? "light" : "dark");-->
<!--    }-->

<!--    document.addEventListener("DOMContentLoaded", () => {-->
<!--        const savedTheme = localStorage.getItem("theme") || "light";-->
<!--        document.documentElement.setAttribute("data-theme", savedTheme);-->
<!--    });-->
<!--</script>-->

<!-- Footer -->
<footer class="bg-gray-900 text-white text-sm py-6 text-center">
    © 2025 Service Foundry. All rights reserved.
</footer>
</body>
</html>